var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},e={},n={},r={};!function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Object.prototype.hasOwnProperty;function n(t){return"function"==typeof t}function r(t){return void 0===t}function i(t){return"[object String]"===Object.prototype.toString.call(t)}t.has=function(t,n){return e.call(t,n)},t.defaultCompare=function(t,e){return t<e?-1:t===e?0:1},t.defaultEquals=function(t,e){return t===e},t.defaultToString=function(t){return null===t?"COLLECTION_NULL":r(t)?"COLLECTION_UNDEFINED":i(t)?"$s"+t:"$o"+t.toString()},t.makeString=function(e,n){if(void 0===n&&(n=","),null===e)return"COLLECTION_NULL";if(r(e))return"COLLECTION_UNDEFINED";if(i(e))return e.toString();var o="{",s=!0;for(var u in e)t.has(e,u)&&(s?s=!1:o+=n,o=o+u+":"+e[u]);return o+"}"},t.isFunction=n,t.isUndefined=r,t.isString=i,t.reverseCompareFunction=function(t){return r(t)||!n(t)?function(t,e){return t<e?1:t===e?0:-1}:function(e,n){return-1*t(e,n)}},t.compareToEquals=function(t){return function(e,n){return 0===t(e,n)}}}(r),Object.defineProperty(n,"__esModule",{value:!0});var i=r;function o(t,e,n){for(var r=n||i.defaultEquals,o=t.length,s=0;s<o;s++)if(r(t[s],e))return s;return-1}n.indexOf=o,n.lastIndexOf=function(t,e,n){for(var r=n||i.defaultEquals,o=t.length-1;o>=0;o--)if(r(t[o],e))return o;return-1},n.contains=function(t,e,n){return o(t,e,n)>=0},n.remove=function(t,e,n){var r=o(t,e,n);return!(r<0)&&(t.splice(r,1),!0)},n.frequency=function(t,e,n){for(var r=n||i.defaultEquals,o=t.length,s=0,u=0;u<o;u++)r(t[u],e)&&s++;return s},n.equals=function(t,e,n){var r=n||i.defaultEquals;if(t.length!==e.length)return!1;for(var o=t.length,s=0;s<o;s++)if(!r(t[s],e[s]))return!1;return!0},n.copy=function(t){return t.concat()},n.swap=function(t,e,n){if(e<0||e>=t.length||n<0||n>=t.length)return!1;var r=t[e];return t[e]=t[n],t[n]=r,!0},n.toString=function(t){return"["+t.toString()+"]"},n.forEach=function(t,e){for(var n=0,r=t;n<r.length;n++){if(!1===e(r[n]))return}};var s={},u={};Object.defineProperty(u,"__esModule",{value:!0});var a=r,c=function(){function t(t){this.table={},this.nElements=0,this.toStr=t||a.defaultToString}return t.prototype.getValue=function(t){var e=this.table["$"+this.toStr(t)];if(!a.isUndefined(e))return e.value},t.prototype.setValue=function(t,e){if(!a.isUndefined(t)&&!a.isUndefined(e)){var n,r="$"+this.toStr(t),i=this.table[r];return a.isUndefined(i)?(this.nElements++,n=void 0):n=i.value,this.table[r]={key:t,value:e},n}},t.prototype.remove=function(t){var e="$"+this.toStr(t),n=this.table[e];if(!a.isUndefined(n))return delete this.table[e],this.nElements--,n.value},t.prototype.keys=function(){var t=[];for(var e in this.table)if(a.has(this.table,e)){var n=this.table[e];t.push(n.key)}return t},t.prototype.values=function(){var t=[];for(var e in this.table)if(a.has(this.table,e)){var n=this.table[e];t.push(n.value)}return t},t.prototype.forEach=function(t){for(var e in this.table)if(a.has(this.table,e)){var n=this.table[e];if(!1===t(n.key,n.value))return}},t.prototype.containsKey=function(t){return!a.isUndefined(this.getValue(t))},t.prototype.clear=function(){this.table={},this.nElements=0},t.prototype.size=function(){return this.nElements},t.prototype.isEmpty=function(){return this.nElements<=0},t.prototype.toString=function(){var t="{";return this.forEach((function(e,n){t+="\n\t"+e+" : "+n})),t+"\n}"},t}();u.default=c;var l={};Object.defineProperty(l,"__esModule",{value:!0});var f=r,h=n,p=u,d=function(){function t(t){this.dictionary=new p.default(t)}return t.prototype.contains=function(t){return this.dictionary.containsKey(t)},t.prototype.add=function(t){return!this.contains(t)&&!f.isUndefined(t)&&(this.dictionary.setValue(t,t),!0)},t.prototype.intersection=function(t){var e=this;this.forEach((function(n){return t.contains(n)||e.remove(n),!0}))},t.prototype.union=function(t){var e=this;t.forEach((function(t){return e.add(t),!0}))},t.prototype.difference=function(t){var e=this;t.forEach((function(t){return e.remove(t),!0}))},t.prototype.isSubsetOf=function(t){if(this.size()>t.size())return!1;var e=!0;return this.forEach((function(n){return!!t.contains(n)||(e=!1,!1)})),e},t.prototype.remove=function(t){return!!this.contains(t)&&(this.dictionary.remove(t),!0)},t.prototype.forEach=function(t){this.dictionary.forEach((function(e,n){return t(n)}))},t.prototype.toArray=function(){return this.dictionary.values()},t.prototype.isEmpty=function(){return this.dictionary.isEmpty()},t.prototype.size=function(){return this.dictionary.size()},t.prototype.clear=function(){this.dictionary.clear()},t.prototype.toString=function(){return h.toString(this.toArray())},t}();l.default=d,Object.defineProperty(s,"__esModule",{value:!0});var y=r,v=u,m=l,_=function(){function t(t){this.toStrF=t||y.defaultToString,this.dictionary=new v.default(this.toStrF),this.nElements=0}return t.prototype.add=function(t,e){if(void 0===e&&(e=1),y.isUndefined(t)||e<=0)return!1;if(this.contains(t))this.dictionary.getValue(t).copies+=e;else{var n={value:t,copies:e};this.dictionary.setValue(t,n)}return this.nElements+=e,!0},t.prototype.count=function(t){return this.contains(t)?this.dictionary.getValue(t).copies:0},t.prototype.contains=function(t){return this.dictionary.containsKey(t)},t.prototype.remove=function(t,e){if(void 0===e&&(e=1),y.isUndefined(t)||e<=0)return!1;if(this.contains(t)){var n=this.dictionary.getValue(t);return e>n.copies?this.nElements-=n.copies:this.nElements-=e,n.copies-=e,n.copies<=0&&this.dictionary.remove(t),!0}return!1},t.prototype.toArray=function(){for(var t=[],e=0,n=this.dictionary.values();e<n.length;e++)for(var r=n[e],i=r.value,o=r.copies,s=0;s<o;s++)t.push(i);return t},t.prototype.toSet=function(){for(var t=new m.default(this.toStrF),e=0,n=this.dictionary.values();e<n.length;e++){var r=n[e].value;t.add(r)}return t},t.prototype.forEach=function(t){this.dictionary.forEach((function(e,n){for(var r=n.value,i=n.copies,o=0;o<i;o++)if(!1===t(r))return!1;return!0}))},t.prototype.size=function(){return this.nElements},t.prototype.isEmpty=function(){return 0===this.nElements},t.prototype.clear=function(){this.nElements=0,this.dictionary.clear()},t}();s.default=_;var g={},x={},w={},b={};Object.defineProperty(b,"__esModule",{value:!0});var E=r,N=n,I=function(){function t(){this.firstNode=null,this.lastNode=null,this.nElements=0}return t.prototype.add=function(t,e){if(E.isUndefined(e)&&(e=this.nElements),e<0||e>this.nElements||E.isUndefined(t))return!1;var n=this.createNode(t);if(0===this.nElements||null===this.lastNode)this.firstNode=n,this.lastNode=n;else if(e===this.nElements)this.lastNode.next=n,this.lastNode=n;else if(0===e)n.next=this.firstNode,this.firstNode=n;else{var r=this.nodeAtIndex(e-1);if(null===r)return!1;n.next=r.next,r.next=n}return this.nElements++,!0},t.prototype.first=function(){if(null!==this.firstNode)return this.firstNode.element},t.prototype.last=function(){if(null!==this.lastNode)return this.lastNode.element},t.prototype.elementAtIndex=function(t){var e=this.nodeAtIndex(t);if(null!==e)return e.element},t.prototype.indexOf=function(t,e){var n=e||E.defaultEquals;if(E.isUndefined(t))return-1;for(var r=this.firstNode,i=0;null!==r;){if(n(r.element,t))return i;i++,r=r.next}return-1},t.prototype.contains=function(t,e){return this.indexOf(t,e)>=0},t.prototype.remove=function(t,e){var n=e||E.defaultEquals;if(this.nElements<1||E.isUndefined(t))return!1;for(var r=null,i=this.firstNode;null!==i;){if(n(i.element,t))return null===r?(this.firstNode=i.next,i===this.lastNode&&(this.lastNode=null)):i===this.lastNode?(this.lastNode=r,r.next=i.next,i.next=null):(r.next=i.next,i.next=null),this.nElements--,!0;r=i,i=i.next}return!1},t.prototype.clear=function(){this.firstNode=null,this.lastNode=null,this.nElements=0},t.prototype.equals=function(e,n){var r=n||E.defaultEquals;return e instanceof t&&(this.size()===e.size()&&this.equalsAux(this.firstNode,e.firstNode,r))},t.prototype.equalsAux=function(t,e,n){for(;null!==t&&null!==e;){if(!n(t.element,e.element))return!1;t=t.next,e=e.next}return!0},t.prototype.removeElementAtIndex=function(t){if(!(t<0||t>=this.nElements||null===this.firstNode||null===this.lastNode)){var e;if(1===this.nElements)e=this.firstNode.element,this.firstNode=null,this.lastNode=null;else{var n=this.nodeAtIndex(t-1);null===n?(e=this.firstNode.element,this.firstNode=this.firstNode.next):n.next===this.lastNode&&(e=this.lastNode.element,this.lastNode=n),null!==n&&null!==n.next&&(e=n.next.element,n.next=n.next.next)}return this.nElements--,e}},t.prototype.forEach=function(t){for(var e=this.firstNode;null!==e&&!1!==t(e.element);)e=e.next},t.prototype.reverse=function(){for(var t=null,e=this.firstNode,n=null;null!==e;)n=e.next,e.next=t,t=e,e=n;n=this.firstNode,this.firstNode=this.lastNode,this.lastNode=n},t.prototype.toArray=function(){for(var t=[],e=this.firstNode;null!==e;)t.push(e.element),e=e.next;return t},t.prototype.size=function(){return this.nElements},t.prototype.isEmpty=function(){return this.nElements<=0},t.prototype.toString=function(){return N.toString(this.toArray())},t.prototype.nodeAtIndex=function(t){if(t<0||t>=this.nElements)return null;if(t===this.nElements-1)return this.lastNode;for(var e=this.firstNode,n=0;n<t&&null!==e;n++)e=e.next;return e},t.prototype.createNode=function(t){return{element:t,next:null}},t}();b.default=I,Object.defineProperty(w,"__esModule",{value:!0});var T=b,A=function(){function t(){this.list=new T.default}return t.prototype.enqueue=function(t){return this.list.add(t)},t.prototype.add=function(t){return this.list.add(t)},t.prototype.dequeue=function(){if(0!==this.list.size()){var t=this.list.first();return this.list.removeElementAtIndex(0),t}},t.prototype.peek=function(){if(0!==this.list.size())return this.list.first()},t.prototype.size=function(){return this.list.size()},t.prototype.contains=function(t,e){return this.list.contains(t,e)},t.prototype.isEmpty=function(){return this.list.size()<=0},t.prototype.clear=function(){this.list.clear()},t.prototype.forEach=function(t){this.list.forEach(t)},t}();w.default=A,Object.defineProperty(x,"__esModule",{value:!0});var C=r,k=w,O=function(){function t(t){this.root=null,this.compare=t||C.defaultCompare,this.nElements=0}return t.prototype.add=function(t){return!C.isUndefined(t)&&(null!==this.insertNode(this.createNode(t))&&(this.nElements++,!0))},t.prototype.clear=function(){this.root=null,this.nElements=0},t.prototype.isEmpty=function(){return 0===this.nElements},t.prototype.size=function(){return this.nElements},t.prototype.contains=function(t){return!C.isUndefined(t)&&null!==this.searchNode(this.root,t)},t.prototype.search=function(t){var e=this.searchNode(this.root,t);if(null!==e)return e.element},t.prototype.remove=function(t){var e=this.searchNode(this.root,t);return null!==e&&(this.removeNode(e),this.nElements--,!0)},t.prototype.inorderTraversal=function(t){this.inorderTraversalAux(this.root,t,{stop:!1})},t.prototype.preorderTraversal=function(t){this.preorderTraversalAux(this.root,t,{stop:!1})},t.prototype.postorderTraversal=function(t){this.postorderTraversalAux(this.root,t,{stop:!1})},t.prototype.levelTraversal=function(t){this.levelTraversalAux(this.root,t)},t.prototype.minimum=function(){if(!this.isEmpty()&&null!==this.root)return this.minimumAux(this.root).element},t.prototype.maximum=function(){if(!this.isEmpty()&&null!==this.root)return this.maximumAux(this.root).element},t.prototype.forEach=function(t){this.inorderTraversal(t)},t.prototype.toArray=function(){var t=[];return this.inorderTraversal((function(e){return t.push(e),!0})),t},t.prototype.height=function(){return this.heightAux(this.root)},t.prototype.searchNode=function(t,e){for(var n=1;null!==t&&0!==n;)(n=this.compare(e,t.element))<0?t=t.leftCh:n>0&&(t=t.rightCh);return t},t.prototype.transplant=function(t,e){null===t.parent?this.root=e:t===t.parent.leftCh?t.parent.leftCh=e:t.parent.rightCh=e,null!==e&&(e.parent=t.parent)},t.prototype.removeNode=function(t){if(null===t.leftCh)this.transplant(t,t.rightCh);else if(null===t.rightCh)this.transplant(t,t.leftCh);else{var e=this.minimumAux(t.rightCh);e.parent!==t&&(this.transplant(e,e.rightCh),e.rightCh=t.rightCh,e.rightCh.parent=e),this.transplant(t,e),e.leftCh=t.leftCh,e.leftCh.parent=e}},t.prototype.inorderTraversalAux=function(t,e,n){null===t||n.stop||(this.inorderTraversalAux(t.leftCh,e,n),n.stop||(n.stop=!1===e(t.element),n.stop||this.inorderTraversalAux(t.rightCh,e,n)))},t.prototype.levelTraversalAux=function(t,e){var n=new k.default;for(null!==t&&n.enqueue(t),t=n.dequeue()||null;null!=t;){if(!1===e(t.element))return;null!==t.leftCh&&n.enqueue(t.leftCh),null!==t.rightCh&&n.enqueue(t.rightCh),t=n.dequeue()||null}},t.prototype.preorderTraversalAux=function(t,e,n){null===t||n.stop||(n.stop=!1===e(t.element),n.stop||(this.preorderTraversalAux(t.leftCh,e,n),n.stop||this.preorderTraversalAux(t.rightCh,e,n)))},t.prototype.postorderTraversalAux=function(t,e,n){null===t||n.stop||(this.postorderTraversalAux(t.leftCh,e,n),n.stop||(this.postorderTraversalAux(t.rightCh,e,n),n.stop||(n.stop=!1===e(t.element))))},t.prototype.minimumAux=function(t){for(;null!=t&&null!==t.leftCh;)t=t.leftCh;return t},t.prototype.maximumAux=function(t){for(;null!=t&&null!==t.rightCh;)t=t.rightCh;return t},t.prototype.heightAux=function(t){return null===t?-1:Math.max(this.heightAux(t.leftCh),this.heightAux(t.rightCh))+1},t.prototype.insertNode=function(t){for(var e=null,n=this.root;null!==n;){var r=this.compare(t.element,n.element);if(0===r)return null;r<0?(e=n,n=n.leftCh):(e=n,n=n.rightCh)}return t.parent=e,null===e?this.root=t:this.compare(t.element,e.element)<0?e.leftCh=t:e.rightCh=t,t},t.prototype.createNode=function(t){return{element:t,leftCh:null,rightCh:null,parent:null}},t}();x.default=O;var S=t&&t.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(g,"__esModule",{value:!0});var V=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return S(e,t),e}(x.default);g.default=V;var R={};Object.defineProperty(R,"__esModule",{value:!0});var L=r,z=n,q=function(){function t(t){this.data=[],this.compare=t||L.defaultCompare}return t.prototype.leftChildIndex=function(t){return 2*t+1},t.prototype.rightChildIndex=function(t){return 2*t+2},t.prototype.parentIndex=function(t){return Math.floor((t-1)/2)},t.prototype.minIndex=function(t,e){return e>=this.data.length?t>=this.data.length?-1:t:this.compare(this.data[t],this.data[e])<=0?t:e},t.prototype.siftUp=function(t){for(var e=this.parentIndex(t);t>0&&this.compare(this.data[e],this.data[t])>0;)z.swap(this.data,e,t),t=e,e=this.parentIndex(t)},t.prototype.siftDown=function(t){for(var e=this.minIndex(this.leftChildIndex(t),this.rightChildIndex(t));e>=0&&this.compare(this.data[t],this.data[e])>0;)z.swap(this.data,e,t),t=e,e=this.minIndex(this.leftChildIndex(t),this.rightChildIndex(t))},t.prototype.peek=function(){return this.data.length>0?this.data[0]:void 0},t.prototype.add=function(t){return!L.isUndefined(t)&&(this.data.push(t),this.siftUp(this.data.length-1),!0)},t.prototype.removeRoot=function(){if(this.data.length>0){var t=this.data[0];return this.data[0]=this.data[this.data.length-1],this.data.splice(this.data.length-1,1),this.data.length>0&&this.siftDown(0),t}},t.prototype.contains=function(t){var e=L.compareToEquals(this.compare);return z.contains(this.data,t,e)},t.prototype.size=function(){return this.data.length},t.prototype.isEmpty=function(){return this.data.length<=0},t.prototype.clear=function(){this.data.length=0},t.prototype.forEach=function(t){z.forEach(this.data,t)},t}();R.default=q;var D={},j=t&&t.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(D,"__esModule",{value:!0});var P=u,U=r,F=function(){function t(t,e){this.key=t,this.value=e}return t.prototype.unlink=function(){this.prev.next=this.next,this.next.prev=this.prev},t}(),M=function(){function t(){this.key=null,this.value=null}return t.prototype.unlink=function(){this.prev.next=this.next,this.next.prev=this.prev},t}();var Q=function(t){function e(e){var n=t.call(this,e)||this;return n.head=new M,n.tail=new M,n.head.next=n.tail,n.tail.prev=n.head,n}return j(e,t),e.prototype.appendToTail=function(t){var e=this.tail.prev;e.next=t,t.prev=e,t.next=this.tail,this.tail.prev=t},e.prototype.getLinkedDictionaryPair=function(t){if(!U.isUndefined(t)){var e="$"+this.toStr(t);return this.table[e]}},e.prototype.getValue=function(t){var e=this.getLinkedDictionaryPair(t);if(!U.isUndefined(e))return e.value},e.prototype.remove=function(e){var n=this.getLinkedDictionaryPair(e);if(!U.isUndefined(n))return t.prototype.remove.call(this,e),n.unlink(),n.value},e.prototype.clear=function(){t.prototype.clear.call(this),this.head.next=this.tail,this.tail.prev=this.head},e.prototype.replace=function(t,e){var n="$"+this.toStr(e.key);e.next=t.next,e.prev=t.prev,this.remove(t.key),e.prev.next=e,e.next.prev=e,this.table[n]=e,++this.nElements},e.prototype.setValue=function(t,e){if(!U.isUndefined(t)&&!U.isUndefined(e)){var n=this.getLinkedDictionaryPair(t),r=new F(t,e),i="$"+this.toStr(t);return U.isUndefined(n)?(this.appendToTail(r),this.table[i]=r,void++this.nElements):(this.replace(n,r),n.value)}},e.prototype.keys=function(){var t=[];return this.forEach((function(e,n){t.push(e)})),t},e.prototype.values=function(){var t=[];return this.forEach((function(e,n){t.push(n)})),t},e.prototype.forEach=function(t){for(var e=this.head.next;e.next;){if(!1===t(e.key,e.value))return;e=e.next}},e}(P.default);D.default=Q;var B={};Object.defineProperty(B,"__esModule",{value:!0});var $=r,H=u,W=n,G=function(){function t(t,e,n){void 0===n&&(n=!1),this.dict=new H.default(t),this.equalsF=e||$.defaultEquals,this.allowDuplicate=n}return t.prototype.getValue=function(t){var e=this.dict.getValue(t);return $.isUndefined(e)?[]:W.copy(e)},t.prototype.setValue=function(t,e){if($.isUndefined(t)||$.isUndefined(e))return!1;var n=this.dict.getValue(t);return $.isUndefined(n)?(this.dict.setValue(t,[e]),!0):!(!this.allowDuplicate&&W.contains(n,e,this.equalsF))&&(n.push(e),!0)},t.prototype.remove=function(t,e){if($.isUndefined(e)){var n=this.dict.remove(t);return!$.isUndefined(n)}var r=this.dict.getValue(t);return!($.isUndefined(r)||!W.remove(r,e,this.equalsF))&&(0===r.length&&this.dict.remove(t),!0)},t.prototype.keys=function(){return this.dict.keys()},t.prototype.values=function(){for(var t=[],e=0,n=this.dict.values();e<n.length;e++)for(var r=0,i=n[e];r<i.length;r++){var o=i[r];t.push(o)}return t},t.prototype.containsKey=function(t){return this.dict.containsKey(t)},t.prototype.clear=function(){this.dict.clear()},t.prototype.size=function(){return this.dict.size()},t.prototype.isEmpty=function(){return this.dict.isEmpty()},t}();B.default=G;var K={},J=t&&t.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(K,"__esModule",{value:!0});var Y=r,X=function(t){function e(e,n){var r=t.call(this,n)||this;return r.defaultFactoryFunction=e,r}return J(e,t),e.prototype.setDefault=function(e,n){var r=t.prototype.getValue.call(this,e);return Y.isUndefined(r)?(this.setValue(e,n),n):r},e.prototype.getValue=function(t){return this.setDefault(t,this.defaultFactoryFunction())},e}(u.default);K.default=X;var Z={};Object.defineProperty(Z,"__esModule",{value:!0});var tt=r,et=R,nt=function(){function t(t){this.heap=new et.default(tt.reverseCompareFunction(t))}return t.prototype.enqueue=function(t){return this.heap.add(t)},t.prototype.add=function(t){return this.heap.add(t)},t.prototype.dequeue=function(){if(0!==this.heap.size()){var t=this.heap.peek();return this.heap.removeRoot(),t}},t.prototype.peek=function(){return this.heap.peek()},t.prototype.contains=function(t){return this.heap.contains(t)},t.prototype.isEmpty=function(){return this.heap.isEmpty()},t.prototype.size=function(){return this.heap.size()},t.prototype.clear=function(){this.heap.clear()},t.prototype.forEach=function(t){this.heap.forEach(t)},t}();Z.default=nt;var rt={};Object.defineProperty(rt,"__esModule",{value:!0});var it=b,ot=function(){function t(){this.list=new it.default}return t.prototype.push=function(t){return this.list.add(t,0)},t.prototype.add=function(t){return this.list.add(t,0)},t.prototype.pop=function(){return this.list.removeElementAtIndex(0)},t.prototype.peek=function(){return this.list.first()},t.prototype.size=function(){return this.list.size()},t.prototype.contains=function(t,e){return this.list.contains(t,e)},t.prototype.isEmpty=function(){return this.list.isEmpty()},t.prototype.clear=function(){this.list.clear()},t.prototype.forEach=function(t){this.list.forEach(t)},t}();rt.default=ot;var st,ut={};Object.defineProperty(ut,"__esModule",{value:!0}),function(t){t[t.BEFORE=0]="BEFORE",t[t.AFTER=1]="AFTER",t[t.INSIDE_AT_END=2]="INSIDE_AT_END",t[t.INSIDE_AT_START=3]="INSIDE_AT_START"}(st||(st={}));var at=function(){function t(t,e){void 0===t&&(t=[]),void 0===e&&(e={}),this.rootIds=t,this.nodes=e,this.initRootIds(),this.initNodes()}return t.prototype.initRootIds=function(){for(var t=0,e=this.rootIds;t<e.length;t++){var n=e[t];this.createEmptyNodeIfNotExist(n)}},t.prototype.initNodes=function(){for(var t in this.nodes)if(this.nodes.hasOwnProperty(t))for(var e=0,n=this.nodes[t];e<n.length;e++){var r=n[e];this.createEmptyNodeIfNotExist(r)}},t.prototype.createEmptyNodeIfNotExist=function(t){this.nodes[t]||(this.nodes[t]=[])},t.prototype.getRootIds=function(){return this.rootIds.slice()},t.prototype.getNodes=function(){var t={};for(var e in this.nodes)this.nodes.hasOwnProperty(e)&&(t[e]=this.nodes[e].slice());return t},t.prototype.getObject=function(){return{rootIds:this.getRootIds(),nodes:this.getNodes()}},t.prototype.toObject=function(){return this.getObject()},t.prototype.flatten=function(){for(var t=this,e=[],n=0;n<this.rootIds.length;n++){var r=this.rootIds[n];e.push({id:r,level:0,hasParent:!1,childrenCount:0}),a(r,this.nodes,e,0)}for(var i=0,o=e;i<o.length;i++){var s=o[i];s.childrenCount=u(s.id)}return e;function u(e){return t.nodes[e]?t.nodes[e].length:0}function a(t,e,n,r){if(void 0===r&&(r=0),t&&e&&n&&e[t]){r++;for(var i=e[t],o=0;o<i.length;o++){var s=i[o];n.push({id:s,level:r,hasParent:!0}),a(s,e,n,r)}r--}}},t.prototype.moveIdBeforeId=function(t,e){return this.moveId(t,e,st.BEFORE)},t.prototype.moveIdAfterId=function(t,e){return this.moveId(t,e,st.AFTER)},t.prototype.moveIdIntoId=function(t,e,n){return void 0===n&&(n=!0),n?this.moveId(t,e,st.INSIDE_AT_START):this.moveId(t,e,st.INSIDE_AT_END)},t.prototype.swapRootIdWithRootId=function(t,e){var n=this.findRootId(t),r=this.findRootId(e);this.swapRootPositionWithRootPosition(n,r)},t.prototype.swapRootPositionWithRootPosition=function(t,e){var n=this.rootIds[e];this.rootIds[e]=this.rootIds[t],this.rootIds[t]=n},t.prototype.deleteId=function(t){this.rootDeleteId(t),this.nodeAndSubNodesDelete(t),this.nodeRefrencesDelete(t)},t.prototype.insertIdBeforeId=function(t,e){var n=this.findRootId(t);for(var r in n>-1&&this.insertIdIntoRoot(e,n),this.nodes)if(this.nodes.hasOwnProperty(r)){var i=this.findNodeId(r,t);i>-1&&this.insertIdIntoNode(r,e,i)}},t.prototype.insertIdAfterId=function(t,e){var n=this.findRootId(t);for(var r in n>-1&&this.insertIdIntoRoot(e,n+1),this.nodes)if(this.nodes.hasOwnProperty(r)){var i=this.findNodeId(r,t);i>-1&&this.insertIdIntoNode(r,e,i+1)}},t.prototype.insertIdIntoId=function(t,e){this.nodeInsertAtEnd(t,e),this.nodes[e]=[]},t.prototype.insertIdIntoRoot=function(t,e){if(void 0===e)this.rootInsertAtEnd(t);else if(e<0){var n=this.rootIds.length;this.rootIds.splice(e+n+1,0,t)}else this.rootIds.splice(e,0,t);this.nodes[t]=this.nodes[t]||[]},t.prototype.insertIdIntoNode=function(t,e,n){if(this.nodes[t]=this.nodes[t]||[],this.nodes[e]=this.nodes[e]||[],void 0===n)this.nodeInsertAtEnd(t,e);else if(n<0){var r=this.nodes[t].length;this.nodes[t].splice(n+r+1,0,e)}else this.nodes[t].splice(n,0,e)},t.prototype.moveId=function(t,e,n){var r=t,i=this.findRootId(r);for(var o in this.nodes[e],this.nodes)if(this.nodes.hasOwnProperty(o)){this.findNodeId(o,e);break}var s=e,u=this.findRootId(s);for(var o in this.nodes[e],this.nodes)if(this.nodes.hasOwnProperty(o)){this.findNodeId(o,e);break}if(i>-1)if(u>-1)switch(this.rootDelete(i),u>i&&u--,n){case st.BEFORE:this.insertIdIntoRoot(r,u);break;case st.AFTER:this.insertIdIntoRoot(r,u+1);break;case st.INSIDE_AT_START:this.nodeInsertAtStart(s,r);break;case st.INSIDE_AT_END:this.nodeInsertAtEnd(s,r)}else for(var o in this.rootDelete(i),this.nodes){if(this.nodes.hasOwnProperty(o))if((a=this.findNodeId(o,s))>-1){switch(n){case st.BEFORE:this.insertIdIntoNode(o,r,a);break;case st.AFTER:this.insertIdIntoNode(o,r,a+1);break;case st.INSIDE_AT_START:this.nodeInsertAtStart(s,r);break;case st.INSIDE_AT_END:this.nodeInsertAtEnd(s,r)}break}}else if(u>-1){for(var o in this.nodes){if(this.nodes.hasOwnProperty(o))if((a=this.findNodeId(o,r))>-1){this.nodeDeleteAtIndex(o,a);break}}switch(n){case st.BEFORE:this.insertIdIntoRoot(r,u);break;case st.AFTER:this.insertIdIntoRoot(r,u+1);break;case st.INSIDE_AT_START:this.nodeInsertAtStart(s,r);break;case st.INSIDE_AT_END:this.nodeInsertAtEnd(s,r)}}else{for(var o in this.nodes){if(this.nodes.hasOwnProperty(o))if((a=this.findNodeId(o,r))>-1){this.nodeDeleteAtIndex(o,a);break}}for(var o in this.nodes){var a;if(this.nodes.hasOwnProperty(o))if((a=this.findNodeId(o,s))>-1){switch(n){case st.BEFORE:this.insertIdIntoNode(o,r,a);break;case st.AFTER:this.insertIdIntoNode(o,r,a+1);break;case st.INSIDE_AT_START:this.nodeInsertAtStart(s,r);break;case st.INSIDE_AT_END:this.nodeInsertAtEnd(s,r)}break}}}},t.prototype.swapArrayElements=function(t,e,n){var r=t[e];return t[e]=t[n],t[n]=r,t},t.prototype.rootDeleteId=function(t){var e=this.findRootId(t);e>-1&&this.rootDelete(e)},t.prototype.nodeAndSubNodesDelete=function(t){for(var e=[],n=0;n<this.nodes[t].length;n++){var r=this.nodes[t][n];this.nodeAndSubNodesDelete(r),e.push(t)}this.nodeDelete(t);for(n=0;n<e.length;n++)this.nodeDelete(e[n])},t.prototype.nodeRefrencesDelete=function(t){for(var e in this.nodes)if(this.nodes.hasOwnProperty(e))for(var n=0;n<this.nodes[e].length;n++){this.nodes[e][n]===t&&this.nodeDeleteAtIndex(e,n)}},t.prototype.nodeDelete=function(t){delete this.nodes[t]},t.prototype.findRootId=function(t){return this.rootIds.indexOf(t)},t.prototype.findNodeId=function(t,e){return this.nodes[t].indexOf(e)},t.prototype.findNode=function(t){return this.nodes[t]},t.prototype.nodeInsertAtStart=function(t,e){this.nodes[t].unshift(e)},t.prototype.nodeInsertAtEnd=function(t,e){this.nodes[t].push(e)},t.prototype.rootDelete=function(t){this.rootIds.splice(t,1)},t.prototype.nodeDeleteAtIndex=function(t,e){this.nodes[t].splice(e,1)},t.prototype.rootInsertAtStart=function(t){this.rootIds.unshift(t)},t.prototype.rootInsertAtEnd=function(t){this.rootIds.push(t)},t}();ut.default=at,Object.defineProperty(e,"__esModule",{value:!0});var ct=n;e.arrays=ct;var lt=s;e.Bag=lt.default;var ft=g,ht=e.BSTree=ft.default,pt=x;e.BSTreeKV=pt.default;var dt=u,yt=e.Dictionary=dt.default,vt=R;e.Heap=vt.default;var mt=D;e.LinkedDictionary=mt.default;var _t=b;e.LinkedList=_t.default;var gt=B;e.MultiDictionary=gt.default;var xt=K;e.FactoryDictionary=xt.default;var wt=K;e.DefaultDictionary=wt.default;var bt=w;e.Queue=bt.default;var Et=Z,Nt=e.PriorityQueue=Et.default,It=l,Tt=e.Set=It.default,At=rt;e.Stack=At.default;var Ct=ut;e.MultiRootTree=Ct.default;var kt=r;e.util=kt;var Ot={exports:{}},St={exports:{}};St.exports=function(){var t="@@type";function e(e){return null!=e&&null!=e.constructor&&e.constructor.prototype!==e&&"string"==typeof e.constructor[t]?e.constructor[t]:Object.prototype.toString.call(e).slice("[object ".length,-"]".length)}return e}(),Ot.exports=function(t){if("undefined"!=typeof __doctest){__doctest.require("./test/Identity");var e=__doctest.require("./test/List"),n=__doctest.require("./test/Maybe");__doctest.require("./test/Sum"),__doctest.require("./test/Tuple"),e.Nil,e.Cons,n.Nothing,n.Just}function r(t){return function(e){return t.concat(e)}}function i(t){return function(e){return t}}function o(t,e){Object.keys(t).forEach(e,t)}function s(t,e){return Object.prototype.hasOwnProperty.call(e,t)}function u(t){return t}function a(t){return function(e){return[t,e]}}function c(e,n){return typeof e==typeof n&&t(e)===t(n)}function l(t){return function(e){return e(t)}}function f(t){return{value:t,done:!1}}function h(t){return{value:t,done:!0}}function p(t,e,n,r){if(!(this instanceof p))return new p(t,e,n,r);this.name=t,this.url=e,this.test=function(t){return n.every((function(e){return e.test(t)}))&&r(t)}}p["@@type"]="sanctuary-type-classes/TypeClass";var d="Constructor",y="Value";function v(t,e,n){for(var r=n,i=0;i<e.length;i+=1){var o=e[i];if(null==r||!t&&!s(o,r))return null;r=r[o]}return"function"==typeof r?r:null}function m(t,e){return v(!0,t,e)}function _(t){return v(!1,t,$t)}var g=s("name",(function(){}))?function(t){return t.name}:function(t){var e=/function (\w*)/.exec(t);return null==e?"":e[1]};function x(e,n,r){function i(e){var n="fantasy-land/"+e;return r[e]===d?function(t){var e=m([n],t);return null==e&&"function"==typeof t?_([g(t),n]):e}:function(e){var r=null;return null!=e&&null!=e.constructor&&e.constructor.prototype===e||(r=m([n],e)),null==r&&(r=_([t(e),"prototype",n])),r&&r.bind(e)}}var o="9.0.0",s=Object.keys(r),u=p("sanctuary-type-classes/"+e,"https://github.com/sanctuary-js/sanctuary-type-classes/tree/v"+o+"#"+e,n,(function(t){return s.every((function(e){var n=r[e]===d?t.constructor:t;return null!=i(e)(n)}))}));return u.methods=s.reduce((function(t,e){return t[e]=i(e),t}),{}),u}var w=x("Setoid",[],{equals:y}),b=x("Ord",[w],{lte:y}),E=x("Semigroupoid",[],{compose:y}),N=x("Category",[E],{id:d}),I=x("Semigroup",[],{concat:y}),T=x("Monoid",[I],{empty:d}),A=x("Group",[T],{invert:y}),C=x("Filterable",[],{filter:y}),k=x("Functor",[],{map:y}),O=x("Bifunctor",[k],{bimap:y}),S=x("Profunctor",[k],{promap:y}),V=x("Apply",[k],{ap:y}),R=x("Applicative",[V],{of:d}),L=x("Chain",[V],{chain:y}),z=x("ChainRec",[L],{chainRec:d}),q=x("Monad",[R,L],{}),D=x("Alt",[k],{alt:y}),j=x("Plus",[D],{zero:d}),P=x("Alternative",[R,j],{}),U=x("Foldable",[],{reduce:y}),F=x("Traversable",[k,U],{traverse:y}),M=x("Extend",[k],{extend:y}),Q=x("Comonad",[M],{extract:y}),B=x("Contravariant",[],{contramap:y});function $(t){return!0}function H(t){return!0}function W(t){return!0}function G(t){return!0}function K(t){return"object"==typeof this?Ht(this.valueOf(),t.valueOf()):this===t}function J(t){return"object"==typeof this?Gt(this.valueOf(),t.valueOf()):!1===this||!0===t}function Y(t){return"object"==typeof this?Ht(this.valueOf(),t.valueOf()):isNaN(this)&&isNaN(t)||this===t}function X(t){return"object"==typeof this?Gt(this.valueOf(),t.valueOf()):isNaN(this)||this<=t}function Z(t){return Ht(this.valueOf(),t.valueOf())}function tt(t){return Gt(this.valueOf(),t.valueOf())}function et(t){return t.source===this.source&&t.global===this.global&&t.ignoreCase===this.ignoreCase&&t.multiline===this.multiline&&t.sticky===this.sticky&&t.unicode===this.unicode}function nt(){return""}function rt(t){return"object"==typeof this?Ht(this.valueOf(),t.valueOf()):this===t}function it(t){return"object"==typeof this?Gt(this.valueOf(),t.valueOf()):this<=t}function ot(t){return this+t}function st(){return[]}function ut(t){return[t]}function at(t,e){for(var n=[],r={},i={head:e,tail:r};i!==r;){for(var o=r,s=t(f,h,i.head),u=0;u<s.length;u+=1){var a=s[u];a.done?n.push(a.value):o={head:a.value,tail:o}}for(i=i.tail;o!==r;)i={head:o.head,tail:i},o=o.tail}return n}function ct(){return[]}function lt(t){if(t.length!==this.length)return!1;for(var e=0;e<this.length;e+=1)if(!Ht(this[e],t[e]))return!1;return!0}function ft(t){for(var e=0;;e+=1){if(e===this.length)return!0;if(e===t.length)return!1;if(!Ht(this[e],t[e]))return Gt(this[e],t[e])}}function ht(t){return this.concat(t)}function pt(t){return this.filter((function(e){return t(e)}))}function dt(t){return this.map((function(e){return t(e)}))}function yt(t){for(var e=[],n=0;n<t.length;n+=1)for(var r=0;r<this.length;r+=1)e.push(t[n](this[r]));return e}function vt(t){for(var e=[],n=0;n<this.length;n+=1)for(var r=0,i=t(this[n]);r<i.length;r+=1)e.push(i[r]);return e}function mt(t,e){for(var n=e,r=0;r<this.length;r+=1)n=t(n,this[r]);return n}function _t(t,e){var n=this;function i(o,s){switch(s){case 0:return _e(t,[]);case 2:return de(a,e(n[o]),e(n[o+1]));default:var u=2*Math.floor(s/4);return de(r,i(o,u),i(o+u,s-u))}}return this.length%2==1?de(r,ae(ut,e(this[0])),i(1,this.length-1)):i(0,this.length)}function gt(t){return this.map((function(e,n,r){return t(r.slice(n))}))}function xt(t){return lt.call(this,t)}function wt(t){return ft.call(this,t)}function bt(t){return Ht(this.name,t.name)&&Ht(this.message,t.message)}function Et(){return{}}function Nt(){return{}}function It(t){var e=this,n=Object.keys(this).sort();return Ht(n,Object.keys(t).sort())&&n.every((function(n){return Ht(e[n],t[n])}))}function Tt(t){for(var e=Object.keys(this).sort(),n=Object.keys(t).sort();;){if(0===e.length)return!0;if(0===n.length)return!1;var r=e.shift(),i=n.shift();if(r<i)return!0;if(r>i)return!1;if(!Ht(this[r],t[r]))return Gt(this[r],t[r])}}function At(t){var e={};function n(t){e[t]=this[t]}return o(this,n),o(t,n),e}function Ct(t){var e={};return o(this,(function(n){t(this[n])&&(e[n]=this[n])})),e}function kt(t){var e={};return o(this,(function(n){e[n]=t(this[n])})),e}function Ot(t){var e={};return o(this,(function(n){s(n,t)&&(e[n]=t[n](this[n]))})),e}function St(t,e){var n=this;function r(e,r){return t(e,n[r])}return Object.keys(this).sort().reduce(r,e)}function Vt(t,e){var n=this;return Object.keys(this).reduce((function(t,r){function i(t){return function(e){var n={};return n[r]=e,At.call(t,n)}}return de(i,t,e(n[r]))}),_e(t,{}))}function Rt(){return u}function Lt(t){return function(e){return t}}function zt(t,e){return function(n){for(var r=f(e);!r.done;)r=t(f,h,r.value)(n);return r.value}}function qt(t){return t===this}function Dt(t){var e=this;return function(n){return t(e(n))}}function jt(t){var e=this;return function(n){return t(e(n))}}function Pt(t,e){var n=this;return function(r){return e(n(t(r)))}}function Ut(t){var e=this;return function(n){return t(n)(e(n))}}function Ft(t){var e=this;return function(n){return t(e(n))(n)}}function Mt(t){var e=this;return function(n){return t((function(t){return e(ee(n,t))}))}}function Qt(t){var e=this;return function(n){return e(t(n))}}var Bt,$t={Null:{prototype:{"fantasy-land/equals":$,"fantasy-land/lte":H}},Undefined:{prototype:{"fantasy-land/equals":W,"fantasy-land/lte":G}},Boolean:{prototype:{"fantasy-land/equals":K,"fantasy-land/lte":J}},Number:{prototype:{"fantasy-land/equals":Y,"fantasy-land/lte":X}},Date:{prototype:{"fantasy-land/equals":Z,"fantasy-land/lte":tt}},RegExp:{prototype:{"fantasy-land/equals":et}},String:{"fantasy-land/empty":nt,prototype:{"fantasy-land/equals":rt,"fantasy-land/lte":it,"fantasy-land/concat":ot}},Array:{"fantasy-land/empty":st,"fantasy-land/of":ut,"fantasy-land/chainRec":at,"fantasy-land/zero":ct,prototype:{"fantasy-land/equals":lt,"fantasy-land/lte":ft,"fantasy-land/concat":ht,"fantasy-land/filter":pt,"fantasy-land/map":dt,"fantasy-land/ap":yt,"fantasy-land/chain":vt,"fantasy-land/alt":ht,"fantasy-land/reduce":mt,"fantasy-land/traverse":_t,"fantasy-land/extend":gt}},Arguments:{prototype:{"fantasy-land/equals":xt,"fantasy-land/lte":wt}},Error:{prototype:{"fantasy-land/equals":bt}},Object:{"fantasy-land/empty":Et,"fantasy-land/zero":Nt,prototype:{"fantasy-land/equals":It,"fantasy-land/lte":Tt,"fantasy-land/concat":At,"fantasy-land/filter":Ct,"fantasy-land/map":kt,"fantasy-land/ap":Ot,"fantasy-land/alt":At,"fantasy-land/reduce":St,"fantasy-land/traverse":Vt}},Function:{"fantasy-land/id":Rt,"fantasy-land/of":Lt,"fantasy-land/chainRec":zt,prototype:{"fantasy-land/equals":qt,"fantasy-land/compose":Dt,"fantasy-land/map":jt,"fantasy-land/promap":Pt,"fantasy-land/ap":Ut,"fantasy-land/chain":Ft,"fantasy-land/extend":Mt,"fantasy-land/contramap":Qt}}},Ht=(Bt=[],function(t,e){if(!c(t,e))return!1;if(Bt.some((function(n){return n[0]===t&&n[1]===e})))return!0;Bt.push([t,e]);try{return w.test(t)&&w.test(e)&&w.methods.equals(t)(e)}finally{Bt.pop()}});function Wt(t,e){return c(t,e)&&!Gt(e,t)}var Gt=function(){var t=[];return function(e,n){if(!c(e,n))return!1;if(t.some((function(t){return t[0]===e&&t[1]===n})))return Ht(e,n);t.push([e,n]);try{return b.test(e)&&b.test(n)&&b.methods.lte(e)(n)}finally{t.pop()}}}();function Kt(t,e){return Wt(e,t)}function Jt(t,e){return Gt(e,t)}function Yt(t,e){return Gt(t,e)?t:e}function Xt(t,e){return Gt(t,e)?e:t}function Zt(t,e){return E.methods.compose(e)(t)}function te(t){return N.methods.id(t)()}function ee(t,e){return I.methods.concat(t)(e)}function ne(t){return T.methods.empty(t)()}function re(t){return A.methods.invert(t)()}function ie(t,e){return C.methods.filter(e)(t)}function oe(t,e){return ie((function(e){return!t(e)}),e)}function se(t,e){var n=!0;return ie((function(e){return n=n&&t(e)}),e)}function ue(t,e){var n=!1;return ie((function(e){return n=n||!t(e)}),e)}function ae(t,e){return k.methods.map(e)(t)}function ce(t,e){return k.methods.map(t)(l(e))}function le(t,e,n){return O.methods.bimap(n)(t,e)}function fe(t,e){return le(t,u,e)}function he(t,e,n){return S.methods.promap(n)(t,e)}function pe(t,e){return V.methods.ap(e)(t)}function de(t,e,n){return pe(ae(t,e),n)}function ye(t,e,n,r){return pe(pe(ae(t,e),n),r)}function ve(t,e){return de(i,t,e)}function me(t,e){return de(i(u),t,e)}function _e(t,e){return R.methods.of(t)(e)}function ge(t,e){return ee(e,_e(e.constructor,t))}function xe(t,e){return ee(_e(e.constructor,t),e)}function we(t,e){return L.methods.chain(e)(t)}function be(t){return we(u,t)}function Ee(t,e,n){return z.methods.chainRec(t)(e,n)}function Ne(t,e){return D.methods.alt(t)(e)}function Ie(t){return j.methods.zero(t)()}function Te(t,e,n){return U.methods.reduce(n)(t,e)}function Ae(t){return Array.isArray(t)?t.length:Te((function(t,e){return t+1}),0,t)}function Ce(t,e){return Te((function(e,n){return e||Ht(t,n)}),!1,e)}function ke(t,e,n){return Te((function(t,n){return ee(t,e(n))}),ne(t),n)}function Oe(t){if(Array.isArray(t))return t.slice().reverse();var e=t.constructor;return Te((function(t,n){return ee(_e(e,n),t)}),ne(e),t)}function Se(t){return Ve(u,t)}function Ve(t,e){var n=Te((function(e,n){return e.push({idx:e.length,x:n,fx:t(n)}),e}),[],e),r=function(t){switch(typeof(t&&t.fx)){case"number":return function(t,e){return t<=e||t!=t};case"string":return function(t,e){return t<=e};default:return Gt}}(n[0]);if(n.sort((function(t,e){return r(t.fx,e.fx)?r(e.fx,t.fx)?t.idx-e.idx:-1:1})),Array.isArray(e)){for(var i=0;i<n.length;i+=1)n[i]=n[i].x;return n}var o=e.constructor,s=ne(o);for(i=0;i<n.length;i+=1)s=ee(s,_e(o,n[i].x));return s}function Re(t,e,n){return F.methods.traverse(n)(t,e)}function Le(t,e){return Re(t,u,e)}function ze(t,e){return M.methods.extend(e)(t)}function qe(t){return ze(u,t)}function De(t){return Q.methods.extract(t)()}function je(t,e){return B.methods.contramap(e)(t)}return{TypeClass:p,Setoid:w,Ord:b,Semigroupoid:E,Category:N,Semigroup:I,Monoid:T,Group:A,Filterable:C,Functor:k,Bifunctor:O,Profunctor:S,Apply:V,Applicative:R,Chain:L,ChainRec:z,Monad:q,Alt:D,Plus:j,Alternative:P,Foldable:U,Traversable:F,Extend:M,Comonad:Q,Contravariant:B,equals:Ht,lt:Wt,lte:Gt,gt:Kt,gte:Jt,min:Yt,max:Xt,compose:Zt,id:te,concat:ee,empty:ne,invert:re,filter:ie,reject:oe,map:ae,flip:ce,bimap:le,mapLeft:fe,promap:he,ap:pe,lift2:de,lift3:ye,apFirst:ve,apSecond:me,of:_e,append:ge,prepend:xe,chain:we,join:be,chainRec:Ee,alt:Ne,zero:Ie,reduce:Te,size:Ae,elem:Ce,foldMap:ke,reverse:Oe,sort:Se,sortBy:Ve,takeWhile:se,dropWhile:ue,traverse:Re,sequence:Le,extend:ze,duplicate:qe,extract:De,contramap:je}}(St.exports);var Vt=function(){function t(e,n){this.rank=e,this.action=n,this.seq=t.nextSeq++}return t.prototype.toString=function(){return this.seq.toString()},t.nextSeq=0,t}(),Rt=function(){function t(){this.inCallback=0,this.toRegen=!1,this.prioritizedQ=new Nt((function(t,e){return t.rank.rank<e.rank.rank?1:t.rank.rank>e.rank.rank?-1:t.seq<e.seq?1:t.seq>e.seq?-1:0})),this.entries=new Tt((function(t){return t.toString()})),this.sampleQ=[],this.lastQ=[],this.postQ=null}return t.prototype.requestRegen=function(){this.toRegen=!0},t.prototype.prioritized=function(t,e){var n=new Vt(t,e);this.prioritizedQ.enqueue(n),this.entries.add(n)},t.prototype.sample=function(t){this.sampleQ.push(t)},t.prototype.last=function(t){this.lastQ.push(t)},t._collectCyclesAtEnd=function(){t.run((function(){return t.collectCyclesAtEnd=!0}))},t.prototype.post=function(t,e){for(null==this.postQ&&(this.postQ=[]);this.postQ.length<=t;)this.postQ.push(null);var n=this.postQ[t],r=null===n?e:function(){n(),e()};this.postQ[t]=r},t.prototype.checkRegen=function(){if(this.toRegen){this.toRegen=!1,this.prioritizedQ.clear();for(var t=this.entries.toArray(),e=0;e<t.length;e++)this.prioritizedQ.enqueue(t[e])}},t.prototype.isActive=function(){return!!t.currentTransaction},t.prototype.close=function(){for(;;){for(;this.checkRegen(),!this.prioritizedQ.isEmpty();){var e=this.prioritizedQ.dequeue();this.entries.remove(e),e.action()}var n=this.sampleQ;this.sampleQ=[];for(var r=0;r<n.length;r++)n[r]();if(this.prioritizedQ.isEmpty()&&this.sampleQ.length<1)break}for(r=0;r<this.lastQ.length;r++)this.lastQ[r]();if(this.lastQ=[],null!=this.postQ){for(r=0;r<this.postQ.length;r++)if(null!=this.postQ[r]){var i=t.currentTransaction;try{if(r>0){t.currentTransaction=new t;try{this.postQ[r](),t.currentTransaction.close()}catch(e){throw t.currentTransaction.close(),e}}else t.currentTransaction=null,this.postQ[r]();t.currentTransaction=i}catch(e){throw t.currentTransaction=i,e}}this.postQ=null}},t.onStart=function(e){t.onStartHooks.push(e)},t.run=function(e){var n=t.currentTransaction;if(null===n){if(!t.runningOnStartHooks){t.runningOnStartHooks=!0;try{for(var r=0;r<t.onStartHooks.length;r++)t.onStartHooks[r]()}finally{t.runningOnStartHooks=!1}}t.currentTransaction=new t}try{var i=e();return null===n&&(t.currentTransaction.close(),t.currentTransaction=null,t.collectCyclesAtEnd&&(Ut.collectCycles(),t.collectCyclesAtEnd=!1)),i}catch(e){throw null===n&&(t.currentTransaction.close(),t.currentTransaction=null),e}},t.currentTransaction=null,t.onStartHooks=[],t.runningOnStartHooks=!1,t.collectCyclesAtEnd=!1,t}(),Lt=0;function zt(){return Lt}var qt,Dt=function(){function t(t,e){if(this.registered=!1,this.deregister_=null,null===t)throw new Error("null origin!");this.origin=t,this.register_=e}return t.prototype.register=function(t){var e=this;this.registered||(this.registered=!0,null!==this.register_?this.deregister_=this.register_():(this.origin.increment(Ut.NULL),t.childrn.push(this.origin),this.deregister_=function(){e.origin.decrement(Ut.NULL);for(var n=t.childrn.length-1;n>=0;--n)if(t.childrn[n]===e.origin){t.childrn.splice(n,1);break}}))},t.prototype.deregister=function(t){this.registered&&(this.registered=!1,null!==this.deregister_&&this.deregister_())},t}();!function(t){t[t.black=0]="black",t[t.gray=1]="gray",t[t.white=2]="white",t[t.purple=3]="purple"}(qt||(qt={}));var jt=[],Pt=0,Ut=function(){function t(t,e,n){this.targets=[],this.childrn=[],this.visited=!1,this.color=qt.black,this.buffered=!1,this.refCountAdj=0,this.name=t,this.rank=e,this.sources=n,this.id=Pt++}return t.prototype.refCount=function(){return this.targets.length},t.prototype.register=function(t){return this.increment(t)},t.prototype.deregister=function(t){this.decrement(t),Rt._collectCyclesAtEnd()},t.prototype.incRefCount=function(t){var e=!1;if(0==this.refCount())for(var n=0;n<this.sources.length;n++)this.sources[n].register(this);return this.targets.push(t),t.childrn.push(this),t.ensureBiggerThan(this.rank)&&(e=!0),Lt++,e},t.prototype.decRefCount=function(t){for(var e=!1,n=t.childrn.length-1;n>=0;n--)if(t.childrn[n]===this){t.childrn.splice(n,1);break}for(n=0;n<this.targets.length;n++)if(this.targets[n]===t){this.targets.splice(n,1),e=!0;break}if(e){if(0==this.refCount())for(n=0;n<this.sources.length;n++)this.sources[n].deregister(this);Lt--}},t.prototype.addSource=function(t){this.sources.push(t),this.refCount()>0&&t.register(this)},t.prototype.ensureBiggerThan=function(t){if(this.visited)return!1;if(this.rank>t)return!1;this.visited=!0,this.rank=t+1;for(var e=0;e<this.targets.length;e++)this.targets[e].ensureBiggerThan(this.rank);return this.visited=!1,!0},t.prototype.descr=function(){var t=null;switch(this.color){case qt.black:t="black";break;case qt.gray:t="gray";break;case qt.white:t="white";break;case qt.purple:t="purple"}for(var e=this.id+" "+this.name+" ["+this.refCount()+"/"+this.refCountAdj+"] "+t+" ->",n=this.children(),r=0;r<n.length;r++)e=e+" "+n[r].id;return e},t.prototype.children=function(){return this.childrn},t.prototype.increment=function(t){return this.incRefCount(t)},t.prototype.decrement=function(t){this.decRefCount(t),0==this.refCount()?this.release():this.possibleRoots()},t.prototype.release=function(){this.color=qt.black,this.buffered||this.free()},t.prototype.free=function(){for(;this.targets.length>0;)this.decRefCount(this.targets[0])},t.prototype.possibleRoots=function(){this.color!=qt.purple&&(this.color=qt.purple,this.buffered||(this.buffered=!0,jt.push(this)))},t.collectCycles=function(){if(!t.collectingCycles)try{t.collectingCycles=!0,t.markRoots(),t.scanRoots(),t.collectRoots();for(var e=t.toBeFreedList.length-1;e>=0;--e){t.toBeFreedList.splice(e,1)[0].free()}}finally{t.collectingCycles=!1}},t.markRoots=function(){for(var e=[],n=0;n<jt.length;n++)jt[n].color==qt.purple?(jt[n].markGray(),e.push(jt[n])):(jt[n].buffered=!1,jt[n].color==qt.black&&0==jt[n].refCount()&&t.toBeFreedList.push(jt[n]));jt=e},t.scanRoots=function(){for(var t=0;t<jt.length;t++)jt[t].scan()},t.collectRoots=function(){for(var t=0;t<jt.length;t++)jt[t].buffered=!1,jt[t].collectWhite();jt=[]},t.prototype.markGray=function(){if(this.color!=qt.gray){this.color=qt.gray;for(var t=this.children(),e=0;e<t.length;e++)t[e].refCountAdj--,t[e].markGray()}},t.prototype.scan=function(){if(this.color==qt.gray)if(this.refCount()+this.refCountAdj>0)this.scanBlack();else{this.color=qt.white;for(var t=this.children(),e=0;e<t.length;e++)t[e].scan()}},t.prototype.scanBlack=function(){this.refCountAdj=0,this.color=qt.black;for(var t=this.children(),e=0;e<t.length;e++)t[e].color!=qt.black&&t[e].scanBlack()},t.prototype.collectWhite=function(){if(this.color==qt.white&&!this.buffered){this.color=qt.black,this.refCountAdj=0;for(var e=this.children(),n=0;n<e.length;n++)e[n].collectWhite();t.toBeFreedList.push(this)}},t.NULL=new t("user",1e12,[]),t.collectingCycles=!1,t.toBeFreedList=[],t}(),Ft=function(t,e){this.f=t,this.deps=e};function Mt(t,e){return new Ft(t,e)}function Qt(t){return t instanceof Ft?t.deps:[]}function Bt(t){return t instanceof Ft?t.f:t}var $t=function(t,e){this.f=t,this.deps=e};function Ht(t,e){return new $t(t,e)}function Wt(t){return t instanceof $t?t.deps:[]}function Gt(t){return t instanceof $t?t.f:t}var Kt=function(t,e){this.f=t,this.deps=e};function Jt(t,e){return new Kt(t,e)}function Yt(t){return t instanceof Kt?t.deps:[]}function Xt(t){return t instanceof Kt?t.f:t}var Zt=function(t,e){this.f=t,this.deps=e};function te(t,e){return new Zt(t,e)}function ee(t){return t instanceof Zt?t.deps:[]}function ne(t){return t instanceof Zt?t.f:t}var re=function(t,e){this.f=t,this.deps=e};function ie(t,e){return new re(t,e)}function oe(t){return t instanceof re?t.deps:[]}function se(t){return t instanceof re?t.f:t}var ue=function(t,e){this.f=t,this.deps=e};function ae(t,e){return new ue(t,e)}function ce(t){return t instanceof ue?t.deps:[]}function le(t){return t instanceof ue?t.f:t}function fe(t){for(var e=[],n=0;n<t.length;n++){var r=t[n];e.push(new Dt(r.getVertex__(),null))}return e}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var he=function(t,e){return he=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},he(t,e)};function pe(t,e){function n(){this.constructor=t}he(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var de=function(){function t(t){this.f=t}return t.prototype.get=function(){return this.f()},t.prototype.map=function(e){var n=this;return new t((function(){return e(n.f())}))},t.prototype.lift=function(e,n){var r=this;return new t((function(){return n(r.f(),e.f())}))},t.prototype.lift3=function(e,n,r){var i=this;return new t((function(){return r(i.f(),e.f(),n.f())}))},t.prototype.lift4=function(e,n,r,i){var o=this;return new t((function(){return i(o.f(),e.f(),n.f(),r.f())}))},t}(),ye=function(){function t(){}return t.UNIT=new t,t}(),ve=function(){function t(){}return t.updates=function(t){return t.getStream__()},t.value=function(e){return Rt.run((function(){var n=new Ie;Rt.currentTransaction.prioritized(n.getVertex__(),(function(){n.send_(ye.UNIT)}));var r=n.snapshot1(e);return t.updates(e).orElse(r)}))},t.defer=function(e){return t.split(e.map((function(t){return[t]})))},t.split=function(t){var e=new Ie(null);return e.setVertex__(new Ut("split",0,[new Dt(t.getVertex__(),(function(){e.getVertex__().childrn.push(t.getVertex__());var n=[];return n.push(t.listen_(Ut.NULL,(function(t){for(var n=function(n){Rt.currentTransaction.post(n,(function(){Rt.run((function(){e.send_(t[n])}))}))},r=0;r<t.length;r++)n(r)}),!1)),n.push((function(){for(var n=e.getVertex__().childrn,r=n.length-1;r>=0;--r)if(n[r]==t.getVertex__()){n.splice(r,1);break}})),function(){n.forEach((function(t){return t()})),n.splice(0,n.length)}}))])),e},t}(),me=function(t,e){this.a=t,this.b=e},_e=function(t){this.hasValue=!1,this.value=null,this.cell=t},ge=function(){this.f=null,this.f_present=!1,this.a=null,this.a_present=!1},xe=function(){function t(t,e){var n=this;this.value=t,e?Rt.run((function(){return n.setStream(e)})):(this.str=new Ne,this.vertex=new Ut("ConstCell",0,[]))}return t.prototype.setStream=function(t){var e=this;this.str=t;var n=this,r=new Dt(t.getVertex__(),(function(){return t.listen_(n.vertex,(function(t){null==n.valueUpdate&&Rt.currentTransaction.last((function(){n.value=n.valueUpdate,n.lazyInitValue=null,n.valueUpdate=null})),n.valueUpdate=t}),!1)}));this.vertex=new Ut("Cell",0,[r]);var i=new Ut("Cell::setStream",1e12,[]);this.vertex.register(i),Rt.currentTransaction.last((function(){e.vertex.deregister(i)}))},t.prototype.getVertex__=function(){return this.vertex},t.prototype.getStream__=function(){return this.str},t.prototype.sample=function(){var t=this;return Rt.run((function(){return t.sampleNoTrans__()}))},t.prototype.sampleNoTrans__=function(){return this.value},t.prototype.sampleLazy=function(){var t=this;return Rt.run((function(){return t.sampleLazyNoTrans__()}))},t.prototype.sampleLazyNoTrans__=function(){var t=this,e=new _e(t);return Rt.currentTransaction.sample((function(){e.value=null!=t.valueUpdate?t.valueUpdate:t.sampleNoTrans__(),e.hasValue=!0,e.cell=null})),new de((function(){return e.hasValue?e.value:e.cell.sample()}))},t.prototype.map=function(t){var e=this;return Rt.run((function(){return ve.updates(e).map(t).holdLazy(e.sampleLazy().map(Bt(t)))}))},t.prototype.lift=function(e,n){var r=Gt(n),i=this.map((function(t){return function(e){return r(t,e)}}));return t.apply(i,e,fe(Wt(n)))},t.prototype.lift3=function(e,n,r){var i=Xt(r),o=this.map((function(t){return function(e){return function(n){return i(t,e,n)}}}));return t.apply(t.apply(o,e),n,fe(Yt(r)))},t.prototype.lift4=function(e,n,r,i){var o=ne(i),s=this.map((function(t){return function(e){return function(n){return function(r){return o(t,e,n,r)}}}}));return t.apply(t.apply(t.apply(s,e),n),r,fe(ee(i)))},t.prototype.lift5=function(e,n,r,i,o){var s=se(o),u=this.map((function(t){return function(e){return function(n){return function(r){return function(i){return s(t,e,n,r,i)}}}}}));return t.apply(t.apply(t.apply(t.apply(u,e),n),r),i,fe(oe(o)))},t.prototype.lift6=function(e,n,r,i,o,s){var u=le(s),a=this.map((function(t){return function(e){return function(n){return function(r){return function(i){return function(o){return u(t,e,n,r,i,o)}}}}}}));return t.apply(t.apply(t.apply(t.apply(t.apply(a,e),n),r),i),o,fe(ce(s)))},t.prototype.tracking=function(t){var e=this,n=new Ie(null),r=new Ut("tracking",0,[new Dt(this.vertex,(function(){var i=function(){},o=function(e){for(var n=i,o=t(e).map((function(t){return t.getVertex__()})),s=0;s<o.length;++s){var u=o[s];r.childrn.push(u),u.increment(Ut.NULL)}i=function(){for(var t=0;t<o.length;++t){for(var e=o[t],n=0;n<r.childrn.length;++n)if(r.childrn[n]===e){r.childrn.splice(n,1);break}e.decrement(Ut.NULL)}},n()};o(e.sample());var s=ve.updates(e).listen_(r,(function(t){o(t),n.send_(t)}),!1);return function(){s(),i()}}))]);return n.setVertex__(r),n.holdLazy(this.sampleLazy())},t.liftArray=function(e){return t._liftArray(e,0,e.length)},t._liftArray=function(e,n,r){if(r-n==0)return new t([]);if(r-n==1)return e[n].map((function(t){return[t]}));var i=Math.floor((n+r)/2);return t._liftArray(e,n,i).lift(t._liftArray(e,i,r),(function(t,e){return function(){return t.concat(e)}})).map((function(t){return t()}))},t.apply=function(t,e,n){return Rt.run((function(){var r=!1,i=new ge,o=new Ie,s=ve.updates(t),u=ve.updates(e),a=function(){r||(r=!0,Rt.currentTransaction.prioritized(o.getVertex__(),(function(){var n=i.f_present?i.f:t.sampleNoTrans__(),s=i.a_present?i.a:e.sampleNoTrans__();o.send_(n(s)),r=!1})))},c=new Dt(s.getVertex__(),(function(){return s.listen_(o.getVertex__(),(function(t){i.f=t,i.f_present=!0,a()}),!1)})),l=new Dt(u.getVertex__(),(function(){return u.listen_(o.getVertex__(),(function(t){i.a=t,i.a_present=!0,a()}),!1)}));return o.setVertex__(new Ut("apply",0,[c,l].concat(n||[]))),o.holdLazy(new de((function(){return t.sampleNoTrans__()(e.sampleNoTrans__())})))}))},t.switchC=function(t){return Rt.run((function(){var e=t.sampleLazy().map((function(t){return t.sample()})),n=new Ie,r=null,i=!1,o=function(){i||(i=!0,Rt.currentTransaction.prioritized(n.getVertex__(),(function(){n.send_(r),r=null,i=!1})))},s=null,u=ve.value(t),a=new Dt(u.getVertex__(),(function(){var t=null===s?null:ve.value(s).listen_(n.getVertex__(),(function(t){r=t,o()}),!1),e=u.listen_(n.getVertex__(),(function(e){s=e;var i=ve.value(e).listen_(n.getVertex__(),(function(t){r=t,o()}),!1);null!==t&&t(),t=i}),!1);return function(){e(),t()}}));return n.setVertex__(new Ut("switchC",0,[a])),n.holdLazy(e)}))},t.switchS=function(t){return Rt.run((function(){var e=new Ie,n=function(t){e.send_(t)},r=new Dt(t.getVertex__(),(function(){var r=t.sampleNoTrans__().listen_(e.getVertex__(),n,!1),i=t.getStream__().listen_(e.getVertex__(),(function(t){var i=t.listen_(e.getVertex__(),n,!0);r(),r=i}),!1);return function(){i(),r()}}));return e.setVertex__(new Ut("switchS",0,[r])),e}))},t.prototype.calm=function(t){return ve.updates(this).collectLazy(this.sampleLazy(),(function(e,n){var r;return r=t(e,n)?null:e,new me(r,e)})).filterNotNull().holdLazy(this.sampleLazy())},t.prototype.calmRefEq=function(){return this.calm((function(t,e){return t===e}))},t.prototype.listen=function(t){var e=this;return Rt.run((function(){return ve.value(e).listen(t)}))},t["fantasy-land/of"]=function(e){return new t(e)},t.prototype["fantasy-land/map"]=function(t){return this.map(t)},t.prototype["fantasy-land/ap"]=function(e){return t.apply(e,this)},t}(),we=function(t,e){this.h=t,this.target=e},be=function(t){function e(e,n){var r=t.call(this,null,null)||this;return Rt.run((function(){n&&r.setStream(n),r.lazyInitValue=e})),r}return pe(e,t),e.prototype.sampleNoTrans__=function(){return null==this.value&&null!=this.lazyInitValue&&(this.value=this.lazyInitValue.get(),this.lazyInitValue=null),this.value},e}(xe),Ee=function(){this.left=null,this.left_present=!1,this.right=null,this.right_present=!1},Ne=function(){function t(t){this.listeners=[],this.firings=[],this.vertex=t||new Ut("Stream",0,[])}return t.prototype.getVertex__=function(){return this.vertex},t.prototype.map=function(t){var e=this,n=new Ie(null),r=Bt(t);return n.vertex=new Ut("map",0,[new Dt(this.vertex,(function(){return e.listen_(n.vertex,(function(t){n.send_(r(t))}),!1)}))].concat(fe(Qt(t)))),n},t.prototype.mapTo=function(t){var e=this,n=new Ie(null);return n.vertex=new Ut("mapTo",0,[new Dt(this.vertex,(function(){return e.listen_(n.vertex,(function(e){n.send_(t)}),!1)}))]),n},t.prototype.orElse=function(t){return this.merge(t,(function(t,e){return t}))},t.prototype.merge=function(t,e){var n=this,r=Gt(e),i=new Ee,o=!1,s=new Ie(null),u=function(){o||(o=!0,Rt.currentTransaction.prioritized(s.getVertex__(),(function(){i.left_present&&i.right_present?s.send_(r(i.left,i.right)):i.left_present?s.send_(i.left):i.right_present&&s.send_(i.right),i.left=null,i.left_present=!1,i.right=null,i.right_present=!1,o=!1})))},a=new Ut("merge",0,[new Dt(this.vertex,(function(){return n.listen_(s.vertex,(function(t){i.left=t,i.left_present=!0,u()}),!1)})),new Dt(t.vertex,(function(){return t.listen_(s.vertex,(function(t){i.right=t,i.right_present=!0,u()}),!1)}))].concat(fe(Wt(e))));return s.vertex=a,s},t.prototype.filter=function(t){var e=this,n=new Ie(null),r=Bt(t);return n.vertex=new Ut("filter",0,[new Dt(this.vertex,(function(){return e.listen_(n.vertex,(function(t){r(t)&&n.send_(t)}),!1)}))].concat(fe(Qt(t)))),n},t.prototype.filterNotNull=function(){var t=this,e=new Ie(null);return e.vertex=new Ut("filterNotNull",0,[new Dt(this.vertex,(function(){return t.listen_(e.vertex,(function(t){null!==t&&e.send_(t)}),!1)}))]),e},t.prototype.gate=function(t){return this.snapshot(t,(function(t,e){return e?t:null})).filterNotNull()},t.prototype.snapshot1=function(t){var e=this,n=new Ie(null);return n.vertex=new Ut("snapshot1",0,[new Dt(this.vertex,(function(){return e.listen_(n.vertex,(function(e){n.send_(t.sampleNoTrans__())}),!1)})),new Dt(t.getVertex__(),null)]),n},t.prototype.snapshot=function(t,e){var n=this,r=new Ie(null),i=Gt(e);return r.vertex=new Ut("snapshot",0,[new Dt(this.vertex,(function(){return n.listen_(r.vertex,(function(e){r.send_(i(e,t.sampleNoTrans__()))}),!1)})),new Dt(t.getVertex__(),null)].concat(fe(Wt(e)))),r},t.prototype.snapshot3=function(t,e,n){var r=this,i=new Ie(null),o=Xt(n);return i.vertex=new Ut("snapshot",0,[new Dt(this.vertex,(function(){return r.listen_(i.vertex,(function(n){i.send_(o(n,t.sampleNoTrans__(),e.sampleNoTrans__()))}),!1)})),new Dt(t.getVertex__(),null),new Dt(e.getVertex__(),null)].concat(fe(Yt(n)))),i},t.prototype.snapshot4=function(t,e,n,r){var i=this,o=new Ie(null),s=ne(r);return o.vertex=new Ut("snapshot",0,[new Dt(this.vertex,(function(){return i.listen_(o.vertex,(function(r){o.send_(s(r,t.sampleNoTrans__(),e.sampleNoTrans__(),n.sampleNoTrans__()))}),!1)})),new Dt(t.getVertex__(),null),new Dt(e.getVertex__(),null),new Dt(n.getVertex__(),null)].concat(fe(ee(r)))),o},t.prototype.snapshot5=function(t,e,n,r,i){var o=this,s=new Ie(null),u=se(i);return s.vertex=new Ut("snapshot",0,[new Dt(this.vertex,(function(){return o.listen_(s.vertex,(function(i){s.send_(u(i,t.sampleNoTrans__(),e.sampleNoTrans__(),n.sampleNoTrans__(),r.sampleNoTrans__()))}),!1)})),new Dt(t.getVertex__(),null),new Dt(e.getVertex__(),null),new Dt(n.getVertex__(),null),new Dt(r.getVertex__(),null)].concat(fe(oe(i)))),s},t.prototype.snapshot6=function(t,e,n,r,i,o){var s=this,u=new Ie(null),a=le(o);return u.vertex=new Ut("snapshot",0,[new Dt(this.vertex,(function(){return s.listen_(u.vertex,(function(o){u.send_(a(o,t.sampleNoTrans__(),e.sampleNoTrans__(),n.sampleNoTrans__(),r.sampleNoTrans__(),i.sampleNoTrans__()))}),!1)})),new Dt(t.getVertex__(),null),new Dt(e.getVertex__(),null),new Dt(n.getVertex__(),null),new Dt(r.getVertex__(),null),new Dt(i.getVertex__(),null)].concat(fe(ce(o)))),u},t.prototype.hold=function(t){return new xe(t,this)},t.prototype.holdLazy=function(t){return new be(t,this)},t.prototype.collect=function(t,e){return this.collectLazy(new de((function(){return t})),e)},t.prototype.collectLazy=function(t,e){var n=this;return Rt.run((function(){var r=new Te,i=r.holdLazy(t),o=n.snapshot(i,e),s=o.map((function(t){return t.a})),u=o.map((function(t){return t.b}));return r.loop(u),s}))},t.prototype.accum=function(t,e){return this.accumLazy(new de((function(){return t})),e)},t.prototype.accumLazy=function(t,e){var n=this;return Rt.run((function(){var r=new Te,i=r.holdLazy(t),o=n.snapshot(i,e);return r.loop(o),o.holdLazy(t)}))},t.prototype.once=function(){var t=this;return Rt.run((function(){return t.gate(t.mapTo(!1).hold(!0))}))},t.prototype.listen=function(t){var e=this;return Rt.run((function(){return e.listen_(Ut.NULL,t,!1)}))},t.prototype.listen_=function(t,e,n){var r=this;this.vertex.register(t)&&Rt.currentTransaction.requestRegen();var i=new we(e,t);if(this.listeners.push(i),!n&&0!=this.firings.length){var o=this.firings.slice();Rt.currentTransaction.prioritized(t,(function(){for(var t=0;t<o.length;t++)e(o[t])}))}return function(){for(var e=!1,n=0;n<r.listeners.length;n++)if(r.listeners[n]==i){r.listeners.splice(n,1),e=!0;break}e&&r.vertex.deregister(t)}},t.prototype["fantasy-land/map"]=function(t){return this.map(t)},t.prototype["fantasy-land/concat"]=function(t){return this.merge(t,(function(t,e){return Ot.exports.Semigroup.test(t)?Ot.exports.concat(t,e):t}))},t.prototype["fantasy-land/empty"]=function(){return new t},t}(),Ie=function(t){function e(e){return t.call(this,e)||this}return pe(e,t),e.prototype.setVertex__=function(t){this.vertex=t},e.prototype.send_=function(t){var e=this;0==this.firings.length&&Rt.currentTransaction.last((function(){e.firings=[]})),this.firings.push(t);for(var n=this.listeners.slice(),r=function(e){var r=n[e].h;Rt.currentTransaction.prioritized(n[e].target,(function(){Rt.currentTransaction.inCallback++;try{r(t),Rt.currentTransaction.inCallback--}catch(t){throw Rt.currentTransaction.inCallback--,t}}))},i=0;i<n.length;i++)r(i)},e}(Ne),Te=function(t){function e(){var e=t.call(this)||this;if(e.assigned__=!1,e.vertex.name="StreamLoop",null===Rt.currentTransaction)throw new Error("StreamLoop/CellLoop must be used within an explicit transaction");return e}return pe(e,t),e.prototype.loop=function(t){var e=this;if(this.assigned__)throw new Error("StreamLoop looped more than once");this.assigned__=!0,this.vertex.addSource(new Dt(t.getVertex__(),(function(){return t.listen_(e.vertex,(function(t){e.send_(t)}),!1)})))},e}(Ie),Ae=function(){function t(t,e){this.f=Gt(t),this.out=e,this.out.getVertex__().sources=this.out.getVertex__().sources.concat(fe(Wt(t))),this.accumValid=!1}return t.prototype.send_=function(t){var e=this;this.accumValid?this.accum=this.f(this.accum,t):(Rt.currentTransaction.prioritized(this.out.getVertex__(),(function(){e.out.send_(e.accum),e.accumValid=!1,e.accum=null})),this.accum=t,this.accumValid=!0)},t}(),Ce=function(t){function e(e){var n=t.call(this)||this;return n.disableListenCheck=!1,e||(e=function(t,e){throw new Error("send() called more than once per transaction, which isn't allowed. Did you want to combine the events? Then pass a combining function to your StreamSink constructor.")}),n.coalescer=new Ae(e,n),n}return pe(e,t),e.prototype.send=function(t){var e=this;Rt.run((function(){if(!e.disableListenCheck&&0==e.vertex.refCount())throw new Error("send() was invoked before listeners were registered");if(Rt.currentTransaction.inCallback>0)throw new Error("You are not allowed to use send() inside a Sodium callback");e.coalescer.send_(t)}))},e.prototype.listen_=function(e,n,r){var i=t.prototype.listen_.call(this,e,n,r);return this.disableListenCheck=!0,i},e}(Ie),ke=function(t){function e(){return t.call(this,null,new Te)||this}return pe(e,t),e.prototype.loop=function(t){var e=this;Rt.run((function(){e.getStream__().loop(t.getStream__()),e.lazyInitValue=t.sampleLazy()}))},e.prototype.sampleNoTrans__=function(){if(!this.getStream__().assigned__)throw new Error("CellLoop sampled before it was looped");return t.prototype.sampleNoTrans__.call(this)},e}(be),Oe=function(t){function e(e,n){return t.call(this,e,new Ce(n))||this}return pe(e,t),e.prototype.send=function(t){this.getStream__().send(t)},e}(xe),Se=function(){function t(t,e,n){var r=this;this._inStream=t,this._table=new yt(n),this._vertex=new Ut("Router",this._inStream.getVertex__().rank+1,[]),this._vertex.addSource(new Dt(this._inStream.getVertex__(),(function(){return r._inStream.listen_(r._vertex,(function(t){for(var i=e(t),o=new Tt(n),s=[],u=0;u<i.length;++u){var a=i[u];if(!o.contains(a)){o.add(a);var c=r._table.getValue(a);if(null!=c)for(var l=0;l<c.length;++l)s.push(c[l])}}for(u=0;u<s.length;++u)s[u].send_(t)}),!0)})))}return t.prototype.filterMatches=function(t){var e=this,n=new Ie,r=new Ut("Router::filterMatches",this._vertex.rank+1,[new Dt(this._vertex,(function(){e._vertex.increment(n.getVertex__());var r=e._table.getValue(t);return null==r&&(r=[],e._table.setValue(t,r)),r.push(n),function(){e._vertex.decrement(n.getVertex__());for(var r=e._table.getValue(t),i=r.length-1;i>=0;--i)if(r[i]==n){r.splice(i,1);break}0==r.length&&e._table.remove(t)}}))]);return n.setVertex__(r),n},t}(),Ve=function(){},Re=0,Le=function(t,e){this.t=t,this.sAlarm=e,this.seq=++Re},ze=function(){function t(t){var e=this;this.eventQueue=new ht((function(t,e){return t.t<e.t?-1:t.t>e.t?1:t.seq<e.seq?-1:t.seq>e.seq?1:0})),Rt.run((function(){e.impl=t,e.tMinimum=0;var n=new Oe(t.now());e.time=n,e.time.listen((function(t){})),Rt.onStart((function(){for(var r=e.tMinimum=Math.max(e.tMinimum,t.now()),i=function(){var t=null;if(!e.eventQueue.isEmpty()){var i=e.eventQueue.minimum();i.t<=r&&(t=i)}if(null==t)return"break";n.send(t.t),Rt.run((function(){return t.sAlarm.send_(t.t)}))};;){if("break"===i())break}n.send(r)}))}))}return t.prototype.at=function(t){var e=this,n=null,r=null,i=!1,o=null,s=!1,u=new Ie(null),a=function(){null!==r&&(r(),e.eventQueue.remove(n)),r=null,n=null,i&&(s||(s=!0,o=t.sampleNoTrans__()),null!==o&&(n=new Le(o,u),e.eventQueue.add(n),r=e.impl.setTimer(o,(function(){e.tMinimum=Math.max(e.tMinimum,o),Rt.run((function(){}))}))))};return u.setVertex__(new Ut("at",0,[new Dt(t.getVertex__(),(function(){i=!0,s=!1,Rt.currentTransaction.prioritized(u.getVertex__(),a);var e=t.getStream__().listen_(u.getVertex__(),(function(t){o=t,s=!0,a()}),!1);return function(){i=!1,a(),e()}}))])),u},t}(),qe=function(t){function e(){return t.call(this,new De)||this}return pe(e,t),e}(ze),De=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return pe(e,t),e.prototype.setTimer=function(t,e){var n=setTimeout(e,Math.max(1e3*(t-this.now()),0));return function(){clearTimeout(n)}},e.prototype.now=function(){return.001*Date.now()},e}(Ve),je=function(t){function e(){return t.call(this,new Pe)||this}return pe(e,t),e}(ze),Pe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return pe(e,t),e.prototype.setTimer=function(t,e){var n=setTimeout(e,Math.max(t-this.now(),0));return function(){clearTimeout(n)}},e.prototype.now=function(){return Date.now()},e}(Ve),Ue=function(){function t(){}
/*!
     * Convert a function that performs asynchronous I/O taking input A
     * and returning a value of type B into an I/O action of type
     * (sa : Stream<A>) => Stream<B>
     */return t.fromAsync=function(t){return function(e){var n=new Ie(null);return n.setVertex__(new Ut("map",0,[new Dt(e.getVertex__(),(function(){return e.listen_(n.getVertex__(),(function(e){t(e,(function(t){Rt.run((function(){n.send_(t)}))}))}),!1)}))])),n}},t}();class Fe{constructor(t,e){this.parent=e,this.source=t}nest(t){return Object.assign(this.migrate(t),{parent:this})}isAncestorOf(t){for(let e=t.parent;e;e=e.parent)if(e===this)return!0;return!1}}class Me extends Fe{constructor(t,e,n,r,i){super(n instanceof Ce?n.send.bind(n):n,i),this.element=t,this.name=e,this.prevValue=r}migrate(t){return new Me(this.element,this.name,t,this.source,this.parent)}accept(t){t.visitAttr(this)}}class Qe extends Fe{constructor(t,e,n,r){super(e,r),this.element=t,this.prevValues=n}migrate(t){return new Qe(this.element,t,this.source,this.parent)}accept(t){t.visitAttributes(this)}}class Be extends Fe{constructor(t,e,n){super(e,n),this.reference=Array.isArray(t)?t:t.nodeType===t.DOCUMENT_FRAGMENT_NODE?[t.firstChild,t.lastChild]:[t]}migrate(t){return new Be(this.reference,t,this.parent)}accept(t){t.visitNode(this)}}class $e{constructor(){this._binding=new Map,this._updates=[],this._lineage=[]}get context(){return this._lineage[this._lineage.length-1]}incarnate(t){const e=t.source;this._binding.set(t,ve.updates(e).listen((n=>this.enqueue([t,n,We(e)])))),this._lineage.push(t),t.nest(e.sample()).accept(this),this._lineage.pop()}enqueue(t){1===this._updates.push(t)&&requestAnimationFrame((()=>this.dequeue()))}dequeue(){const t=this._updates;for(;t.length;)t.splice(0).filter((([t],e,n)=>n.every((([e])=>t===e||!e.isAncestorOf(t))))).forEach((([t,e])=>{this.garbageCollect(t),t.nest(e).accept(this)}))}garbageCollect(t){Array.from(this._binding.keys()).filter((e=>t.isAncestorOf(e))).forEach((t=>{this._binding.get(t),this._binding.delete(t)}))}buildNode(t,e){t instanceof Ge?this.buildNode(t.source,e):t instanceof xe?this.incarnate(new Be(e.appendChild(new Comment("")),t,this.context)):t instanceof Node?e.append(t):Object(t)!==t?e.append(new Text(null==t?"":t+"")):Array.isArray(t)?t.forEach((t=>this.buildNode(t,e))):this.buildElement(t,e)}buildElement(t,e){const n=Object.keys(t).find((t=>"$"!==t)),r=t.$,i=t[n],o=e.ownerDocument.createElement(n);e.append(o),null!=i&&this.buildNode(i,o),Object(r)===r&&this.visitAttributes(new Qe(o,r,void 0,this.context))}visitNode(t){const e=t.reference.slice(0),n=e[0],r=n.ownerDocument.createDocumentFragment();if(this.buildNode(t.source,r),t.reference.splice(0,2,...2===r.childNodes.length?[r.firstChild,r.lastChild]:[r.firstChild]),e.every((t=>t.isConnected))){const t=new Range;2===e.length?(t.setStartBefore(n),t.setEndAfter(e[1])):t.selectNode(n);const i=t.endOffset;t.insertNode(r),t.setStart(t.startContainer,t.startOffset+t.endOffset-i),t.deleteContents()}else{const t=n.parentNode;if(!t)return;if(e[1]){for(t.insertBefore(r,n);n.nextSibling&&n.nextSibling!==e[1];)t.removeChild(n.nextSibling);t.removeChild(n),t.removeChild(e[1])}else t.replaceChild(r,n)}}visitAttributes(t){const e=t.source;if(e instanceof xe)this.incarnate(t);else{const n=t.element,r=t.prevValues||{};Object.keys(Object.assign({},t.source,t.prevValues)).map((t=>new Me(n,t,e[t],r[t]))).forEach((t=>this.visitAttr(t)))}}visitAttr(t){const{element:e,name:n,source:r,prevValue:i}=t;r instanceof xe?this.incarnate(t):/^on./.test(n)?(He(i)&&e.removeEventListener(n.slice(2),i,!1),He(r)&&e.addEventListener(n.slice(2),r,!1)):null==r||""==r?e.removeAttribute(n):Object(r)!==r?e.setAttribute(n,""+r):/^class(List)?$/.test(n)&&(e.className=Array.isArray(r)?r.filter(Boolean).join(" "):""+r)}}function He(t){return!!t&&("function"==typeof t||"function"==typeof t.handleEvent)}function We(t){const e=t.sample();return e instanceof xe?We(e):e}class Ge{constructor(t){this.placeholder=new Comment("jshtml-placeholder"),this.source=t}createVisitor(){return new this.constructor.visitorConstructor}map(t){return new this.constructor(t(this.source))}wrap(t,e){return new this.constructor({[t]:this.source,$:e})}mount(t){new Be(t,this.source).accept(this.createVisitor())}mountAsContents(t){(t.hasChildNodes()?new Be([t.firstChild,t.lastChild],this.source):new Be(t.appendChild(this.placeholder.cloneNode(!1)),this.source)).accept(this.createVisitor())}appendTo(t){this.mount(t.appendChild(this.placeholder.cloneNode(!1)))}prependTo(t){this.mount(t.insertBefore(this.placeholder.cloneNode(!1),t.firstChild))}}Ge.visitorConstructor=$e;class Ke extends Fe{constructor(t,e,n,r){super(n,r),this.element=t,this.cssprop=e}accept(t){t.visitStyle(this)}migrate(t){return new Ke(this.element,this.cssprop,t,this.parent)}}class Je extends Fe{constructor(t,e,n,r){super(n,r),this.element=t,this.dataname=e}accept(t){t.visitDataset(this)}migrate(t){return new Je(this.element,this.dataname,t,this.parent)}}class Ye extends $e{buildNode(t,e){return super.buildNode(t instanceof HTMLTemplateElement?t.content.cloneNode(!0):t,e)}visitAttr(t){const{element:e,name:n}=t,r=t.source;if(!(e instanceof HTMLElement&&("style"===n||"dataset"===n)&&Object(r)===r))return super.visitAttr(t);const i=Object.keys(Object.assign({},r,t.prevValue));"style"===n?i.forEach((n=>this.visitStyle(new Ke(e,n,r[n],t)))):i.forEach((n=>this.visitDataset(new Je(e,n,r[n],t))))}visitStyle(t){const{source:e,element:n,cssprop:r}=t;e instanceof xe?this.incarnate(t):n.style[r]=null==e?"":""+e}visitDataset(t){const{source:e,dataname:n,element:r}=t;e instanceof xe?this.incarnate(t):null==e?delete r.dataset[Xe(n)]:r.dataset[Xe(n)]=e}}function Xe(t){return t.replace(/-[a-z]/g,(t=>t.charAt(1).toUpperCase()))}class Ze extends Ge{defineAs(t,e={}){var n;const r=e.super||HTMLElement,i=e.shadow||{mode:"closed"},o=t=>this.mountAsContents(t.attachShadow(i)),s=((n=class extends r{constructor(...t){super(...t),o(this)}}).tag=t,n);return customElements.define(t,s),s}}Ze.visitorConstructor=Ye;const tn=t=>{const e={},n=t=>e[t.type].send(t);return new Proxy(e,{get:(e,r)=>"symbol"==typeof r||e.hasOwnProperty(r)?Reflect.get(e,r):(t.addEventListener(r,n),e[r]=new Ce)})},en=(t,e)=>{const n=new Ce;return new MutationObserver(n.send.bind(n)).observe(t,e),ve.split(n)},nn=(t,e)=>{const n=en(t,{attributes:!0,attributeFilter:e});return new Proxy({},{get:(e,r)=>("string"!=typeof r||e.hasOwnProperty(r)||Reflect.set(e,r,n.filter((t=>t.attributeName===r)).map((t=>t.target.getAttribute(r)||"")).hold(t.hasAttribute(r)&&t.getAttribute(r)||"")),Reflect.get(e,r))})},rn=(t,e)=>e?n=>({[t]:n,$:e}):e=>({[t]:e}),on={apply:(t,e,n)=>new t(n[0])},sn=new Proxy(Ge,on),un=new Proxy(Ze,on);export{xe as Cell,ke as CellLoop,Oe as CellSink,Ue as IOAction,je as MillisecondsTimerSystem,ve as Operational,Se as Router,qe as SecondsTimerSystem,Ne as Stream,Te as StreamLoop,Ce as StreamSink,ze as TimerSystem,Ve as TimerSystemImpl,Rt as Transaction,me as Tuple2,ye as Unit,Ut as Vertex,nn as attributes,tn as events,zt as getTotalRegistrations,un as jshtml,Ye as jshtmlVisitor,sn as jsxml,$e as jsxmlVisitor,Mt as lambda1,Ht as lambda2,Jt as lambda3,te as lambda4,ie as lambda5,ae as lambda6,en as mutations,rn as wrap};
