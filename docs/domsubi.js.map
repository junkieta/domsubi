{"version":3,"file":"domsubi.js","sources":["../src/domsubi/jsxmlComponent.ts","../src/domsubi/jsxmlAttr.ts","../src/domsubi/jsxmlAttributes.ts","../src/domsubi/jsxmlNode.ts","../src/domsubi/jsxmlVisitor.ts","../src/domsubi/jsxml.ts","../src/domsubi/jshtmlInlineStyleRule.ts","../src/domsubi/jshtmlDataset.ts","../src/domsubi/jshtmlVisitor.ts","../src/domsubi/jshtml.ts","../src/domsubi/AnimationFrameTimerSystem.ts","../src/domsubi/nornir.ts","../src/Lib.ts"],"sourcesContent":["import { jsxmlComponentVisitor } from \"./jsxmlComponentVisitor\";\r\nimport { DOMSource } from \"./types\";\r\n\r\n\r\nexport abstract class jsxmlComponent {\r\n\r\n    abstract accept(visitor: jsxmlComponentVisitor): void;\r\n    abstract migrate(newValue: DOMSource) : jsxmlComponent;\r\n\r\n    source: DOMSource\r\n    parent?: jsxmlComponent\r\n\r\n    constructor(source: DOMSource, parent?: jsxmlComponent) {\r\n        this.parent = parent;\r\n        this.source = source;\r\n    }\r\n\r\n    nest(newValue: DOMSource) : jsxmlComponent {\r\n        return Object.assign(this.migrate(newValue), { parent: this })\r\n    }\r\n\r\n    isAncestorOf<C extends jsxmlComponent>(that: C) {\r\n        for(let ctx = that.parent; ctx; ctx = ctx.parent) if(ctx === this) return true;\r\n        return false;\r\n    }\r\n\r\n}\r\n","import { StreamSink } from \"sodiumjs\";\r\nimport { jsxmlComponent } from \"./jsxmlComponent\";\r\nimport { jsxmlComponentVisitor } from \"./jsxmlComponentVisitor\";\r\nimport { AttrValue, DOMSource } from \"./types\";\r\n\r\nexport class jsxmlAttr extends jsxmlComponent {\r\n\r\n    public element: Element;\r\n    public name: string;\r\n    public prevValue?: AttrValue;\r\n\r\n    constructor(element: Element, name: string, source: AttrValue, old_source?: AttrValue, parent?: jsxmlComponent) {\r\n        super(source instanceof StreamSink ? source.send.bind(source) : source, parent)\r\n        this.element = element;\r\n        this.name = name;\r\n        this.prevValue = old_source;\r\n    }\r\n\r\n    migrate(v: DOMSource) {\r\n        return new jsxmlAttr(this.element, this.name, v, this.source, this.parent);\r\n    }\r\n\r\n    accept(visitor: jsxmlComponentVisitor): void {\r\n        visitor.visitAttr(this);\r\n    }\r\n\r\n}\r\n","import { jsxmlComponent } from \"./jsxmlComponent\";\r\nimport { jsxmlVisitor } from \"./jsxmlVisitor\";\r\nimport { DOMSource } from \"./types\";\r\n\r\nexport class jsxmlAttributes extends jsxmlComponent {\r\n\r\n    public element: Element;\r\n    prevValues?: DOMSource;\r\n\r\n    constructor(elm: Element, source: DOMSource, prev?: DOMSource, parent?: jsxmlComponent) {\r\n        super(source, parent);\r\n        this.element = elm;\r\n        this.prevValues = prev;\r\n    }\r\n\r\n    migrate(newValue: DOMSource) {\r\n        return new jsxmlAttributes(this.element, newValue, this.source, this.parent);\r\n    }\r\n\r\n    accept(visitor: jsxmlVisitor): void {\r\n        visitor.visitAttributes(this);\r\n    }\r\n\r\n}\r\n","import { jsxmlComponent } from \"./jsxmlComponent\";\r\nimport { jsxmlComponentVisitor } from \"./jsxmlComponentVisitor\";\r\nimport { NodeSource } from \"./types\";\r\n\r\nexport class jsxmlNode extends jsxmlComponent {\r\n\r\n    reference: [Node] | [Node,Node];\r\n\r\n    constructor(ref: Node | [Node] | [Node,Node], source: NodeSource, parent?: jsxmlComponent) {\r\n        super(source, parent);\r\n        this.reference = Array.isArray(ref)\r\n            ? ref\r\n            : ref.nodeType === ref.DOCUMENT_FRAGMENT_NODE\r\n            ? [ref.firstChild, ref.lastChild] as [Node,Node]\r\n            : [ref];\r\n    }\r\n\r\n    migrate(source: NodeSource) {\r\n        return new jsxmlNode(this.reference, source, this.parent);\r\n    }\r\n\r\n    accept(visitor: jsxmlComponentVisitor): void {\r\n        visitor.visitNode(this);\r\n    }\r\n\r\n}\r\n","import { jsxmlComponent } from \"./jsxmlComponent\";\r\nimport { jsxmlAttr } from \"./jsxmlAttr\";\r\nimport { Cell, Operational } from \"sodiumjs\";\r\nimport { jsxmlAttributes } from \"./jsxmlAttributes\";\r\nimport { jsxmlNode } from \"./jsxmlNode\";\r\nimport { DOMSource, ElementSource, AttributesSource, AttrValue } from \"./types\";\r\nimport { jsxmlComponentVisitor } from \"./jsxmlComponentVisitor\";\r\n\r\ntype UPDATE_INFO = [jsxmlComponent, DOMSource, DOMSource];\r\n\r\nexport class jsxmlVisitor implements jsxmlComponentVisitor {\r\n\r\n    private _lineage: jsxmlComponent[];\r\n    private _binding: Map<jsxmlComponent, Function>;\r\n    private _updates: UPDATE_INFO[];\r\n\r\n    get context() {\r\n        return this._lineage[this._lineage.length - 1];\r\n    }\r\n\r\n    constructor() {\r\n        this._binding = new Map();\r\n        this._updates = [];\r\n        this._lineage = [];\r\n    }\r\n\r\n    incarnate(c: jsxmlComponent) {\r\n        const cell = c.source as Cell<DOMSource>;\r\n        this._binding.set(c, Operational.updates(cell).listen((v) => this.enqueue([c, v, deepSample(cell)])));\r\n        this._lineage.push(c);\r\n        c.nest(cell.sample()).accept(this);\r\n        this._lineage.pop();\r\n    }\r\n\r\n    /* sodiumのガベージコレクションと整合性がとれるならアップデートイベントをmergeしてから更新にしたいが...\r\n    end() {\r\n        const merged = Array.from(this._bindings.keys())\r\n            .map((c) => Operational.updates((c.source as Cell<DOMSource>)).mapTo([c]))\r\n            .reduce((a,b) =>\r\n                a.merge(b, (a,[b]) => a.some((a) => a.isAncestorOf(b))\r\n                    ? a\r\n                    : a.filter((a) => !b.isAncestorOf(a)).concat(b)))\r\n            .once();\r\n        \r\n        Operational\r\n            .defer(merged)\r\n            .listen((updated) => {\r\n                updated.forEach((c) => this.garbageCollect(c));\r\n                updated.forEach((c) => c.accept(this))\r\n            });\r\n    }\r\n    */\r\n\r\n    enqueue(i: UPDATE_INFO) {\r\n        if (this._updates.push(i) === 1) requestAnimationFrame(() => this.dequeue());\r\n    }\r\n\r\n    dequeue() {\r\n        const u = this._updates;\r\n        while (u.length) {\r\n            u.splice(0)\r\n                .filter(([a], i, q) => q.every(([b]) => a === b || !b.isAncestorOf(a)))\r\n                .forEach(([ctx, v]) => {\r\n                    this.garbageCollect(ctx);\r\n                    ctx.nest(v).accept(this);\r\n                })\r\n        }\r\n    }\r\n\r\n    garbageCollect(ctx: jsxmlComponent) {\r\n        Array.from(this._binding.keys())\r\n            .filter((that) => ctx.isAncestorOf(that))\r\n            .forEach((that) => {\r\n                this._binding.get(that) ?? (void 0);\r\n                this._binding.delete(that)\r\n            })\r\n    }\r\n\r\n    buildNode(source: DOMSource, parent: ParentNode) {\r\n        if (source instanceof Cell)\r\n            this.incarnate(new jsxmlNode(parent.appendChild(new Comment('')), source, this.context));\r\n        else if (source instanceof Node)\r\n            parent.append(source);\r\n        else if (Object(source) !== source)\r\n            parent.append(new Text(source === undefined || source === null ? '' : source + ''));\r\n        else if (Array.isArray(source))\r\n            source.forEach((s) => this.buildNode(s, parent));\r\n        else\r\n            this.buildElement(source as ElementSource, parent);\r\n    }\r\n\r\n    buildElement(source: ElementSource, p: ParentNode) {\r\n        const tag = Object.keys(source).find((k) => k !== '$') as keyof HTMLElementTagNameMap;\r\n        const attrs = source.$ as AttributesSource;\r\n        const children = source[tag];\r\n        const elm = (p.ownerDocument as Document).createElement(tag);\r\n        p.append(elm);\r\n        if (children != null)\r\n            this.buildNode(children, elm);\r\n        if (Object(attrs) === attrs)\r\n            this.visitAttributes(new jsxmlAttributes(elm, attrs, undefined, this.context));\r\n    }\r\n\r\n    visitNode(o: jsxmlNode): void {\r\n        const ref = o.reference.slice(0);\r\n        const n = ref[0];\r\n        const doc = n.ownerDocument as Document;\r\n        const df = doc.createDocumentFragment();\r\n        this.buildNode(o.source, df);\r\n        // リファレンス更新\r\n        o.reference.splice(0,2, ...(df.childNodes.length === 2 ? [df.firstChild,df.lastChild] : [df.firstChild]) as Node[]);\r\n        // DOM更新(Document接続済み)\r\n        if (ref.every((n) => n.isConnected)) {\r\n            const r = new Range();\r\n            if(ref.length === 2) {\r\n                r.setStartBefore(n);\r\n                r.setEndAfter(ref[1]);\r\n            } else {\r\n                r.selectNode(n)\r\n            }\r\n            const o = r.endOffset;\r\n            r.insertNode(df);\r\n            r.setStart(r.startContainer, r.startOffset + r.endOffset - o);\r\n            r.deleteContents();\r\n        }\r\n        // DOM更新(Document接続なし)\r\n        else {\r\n            const parent = n.parentNode;\r\n            if (!parent) return;\r\n            if (!ref[1]) {\r\n                parent.replaceChild(df, n);\r\n            } else {\r\n                parent.insertBefore(df, n);\r\n                while (n.nextSibling && n.nextSibling !== ref[1]) parent.removeChild(n.nextSibling);\r\n                parent.removeChild(n);\r\n                parent.removeChild(ref[1]);\r\n            }\r\n        }\r\n\r\n        \r\n    }\r\n\r\n    visitAttributes(attrs: jsxmlAttributes) {\r\n        const source = attrs.source;\r\n        if (source instanceof Cell) {\r\n            this.incarnate(attrs);\r\n        } else {\r\n            type V = { [key: string]: AttrValue; };\r\n            const elm = attrs.element;\r\n            const prev = attrs.prevValues || {};\r\n            Object.keys(Object.assign({}, attrs.source, attrs.prevValues))\r\n                .map((k) => new jsxmlAttr(elm, k, (source as V)[k], (prev as V)[k]))\r\n                .forEach((attr) => this.visitAttr(attr));\r\n        }\r\n    }\r\n\r\n    visitAttr(attr: jsxmlAttr) {\r\n        const { element, name, source, prevValue } = attr;\r\n\r\n        if (source instanceof Cell) {\r\n            this.incarnate(attr);\r\n        }\r\n\r\n        else if (/^on./.test(name)) {\r\n            if (validateEventListenable(prevValue))\r\n                element.removeEventListener(name.slice(2), <EventListenerOrEventListenerObject>prevValue, false);\r\n            if (validateEventListenable(source))\r\n                element.addEventListener(name.slice(2), <EventListenerOrEventListenerObject>source, false);\r\n        }\r\n\r\n        else if (source == null || source == '')\r\n            element.removeAttribute(name);\r\n\r\n        else if (Object(source) !== source)\r\n            element.setAttribute(name, \"\" + source);\r\n\r\n        else if (/^class(List)?$/.test(name))\r\n            element.className = Array.isArray(source)\r\n                ? source.filter(Boolean).join(\" \")\r\n                : '' + source;\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\n/**\r\n * 引数がイベントリスナか判定する\r\n * @param value\r\n */\r\nfunction validateEventListenable(value: unknown): boolean {\r\n    return !!(value) && (typeof value === \"function\" || typeof (<EventListenerObject>value).handleEvent === 'function');\r\n}\r\n\r\nfunction deepSample<V>(c: Cell<V> | Cell<Cell<V>>): V {\r\n    const v = c.sample();\r\n    return v instanceof Cell ? deepSample(v) : v;\r\n}\r\n","import { jsxmlVisitor } from \"./jsxmlVisitor\";\r\nimport { jsxmlNode } from \"./jsxmlNode\";\r\nimport { NodeSource, AttributesSource } from \"./types\";\r\nimport { jsxmlComponentVisitor } from \"./jsxmlComponentVisitor\";\r\n\r\nexport class jsxml {\r\n\r\n    protected _visitor : { new(): jsxmlComponentVisitor } = jsxmlVisitor;\r\n\r\n    source: NodeSource\r\n\r\n    constructor(s: NodeSource) {\r\n        this.source = s;\r\n    }\r\n\r\n    wrapAsElement<T extends jsxml>(tag:string, attrs?: AttributesSource) : T {\r\n        return new (this.constructor as { new(s:NodeSource): T })({ [tag]: this.source, $: attrs }) as T\r\n    }\r\n\r\n    mount(n: Node) {\r\n        const root = new jsxmlNode(n, this.source)\r\n        const visitor = new this._visitor();\r\n        root.accept(visitor);\r\n    }\r\n\r\n    mountAsContents(n: Node) {\r\n        const root = n.hasChildNodes()\r\n            ? new jsxmlNode([n.firstChild,n.lastChild] as [Node,Node], this.source)\r\n            : new jsxmlNode(n.appendChild(new Comment('jsxml-placeholder')), this.source)\r\n        const visitor = new this._visitor();\r\n        root.accept(visitor);\r\n    }\r\n\r\n}\r\n\r\n","import { jsxmlComponent } from \"./jsxmlComponent\";\r\nimport { jshtmlVisitor } from \"./jshtmlVisitor\";\r\nimport { DOMSource, DOMStringSource } from \"./types\";\r\n\r\nexport class jshtmlInlineStyleRule extends jsxmlComponent {\r\n    element: HTMLElement\r\n    cssprop: string;\r\n\r\n    constructor(element: HTMLElement, cssprop: string, source: DOMStringSource, parent?: jsxmlComponent) {\r\n        super(source, parent);\r\n        this.element = element;\r\n        this.cssprop = cssprop;\r\n    }\r\n\r\n    accept(visitor: jshtmlVisitor): void {\r\n        visitor.visitStyle(this)\r\n    }\r\n\r\n    migrate(v:DOMSource) {\r\n        return new jshtmlInlineStyleRule(this.element, this.cssprop, v, this.parent);\r\n    }\r\n\r\n\r\n}\r\n","import { jsxmlComponent } from \"./jsxmlComponent\";\r\nimport { jshtmlVisitor } from \"./jshtmlVisitor\";\r\nimport { DOMSource, DOMStringSource } from \"./types\";\r\n\r\nexport class jshtmlDatasetValue extends jsxmlComponent {\r\n\r\n    element: HTMLElement;\r\n    dataname: string;\r\n\r\n    constructor(element: HTMLElement, dataname: string, source: DOMStringSource, parent?: jsxmlComponent) {\r\n        super(source, parent);\r\n        this.element = element;\r\n        this.dataname = dataname;\r\n    }\r\n\r\n    accept(visitor: jshtmlVisitor): void {\r\n        visitor.visitDataset(this);\r\n    }\r\n\r\n    migrate(v: DOMSource) {\r\n        return new jshtmlDatasetValue(this.element, this.dataname, v, this.parent);\r\n    }\r\n\r\n}\r\n","import { Cell } from \"sodiumjs\";\r\nimport { jsxmlAttr } from \"./jsxmlAttr\";\r\nimport { jshtmlInlineStyleRule } from \"./jshtmlInlineStyleRule\";\r\nimport { jshtmlDatasetValue } from \"./jshtmlDataset\";\r\nimport { jsxmlVisitor } from \"./jsxmlVisitor\";\r\nimport { NodeSource } from \"./types\";\r\n\r\nexport class jshtmlVisitor extends jsxmlVisitor {\r\n\r\n    buildNode(source: NodeSource, parent: ParentNode) {\r\n        // HTMLTemplateElementだけはcontentをcloneしてビルド\r\n        return super.buildNode(source instanceof HTMLTemplateElement ? source.content.cloneNode(true) : source, parent);\r\n    }\r\n\r\n    /**\r\n     * インラインstyleとdatasetに対応する\r\n     */\r\n    visitAttr(attr: jsxmlAttr) {\r\n        const { element, name, source } = attr;\r\n        const isHtmlSpecialized = element instanceof HTMLElement &&\r\n            (name === 'style' || name === 'dataset') &&\r\n            Object(source) === source;\r\n\r\n        if (!isHtmlSpecialized)\r\n            super.visitAttr(attr);\r\n        else\r\n            Object.keys(Object.assign({}, source, attr.prevValue))\r\n                .forEach(name === 'style'\r\n                    ? (k) => this.visitStyle(new jshtmlInlineStyleRule(element, k, (source as { [key: string]: string; })[k], attr))\r\n                    : (k) => this.visitDataset(new jshtmlDatasetValue(element, k, (source as { [key: string]: string; })[k], attr)));\r\n    }\r\n\r\n    visitStyle(style: jshtmlInlineStyleRule) {\r\n        const v = style.source;\r\n        if (v instanceof Cell) {\r\n            this.incarnate(style);\r\n        } else {\r\n            const s = style.element.style;\r\n            const n = camelToHyphenSeparated(style.cssprop);\r\n            if (v === null || v === undefined)\r\n                s.removeProperty(n);\r\n\r\n            else\r\n                s.setProperty(n, v + '');\r\n        }\r\n    }\r\n\r\n    visitDataset(data: jshtmlDatasetValue) {\r\n        const v = data.source;\r\n        if (v instanceof Cell)\r\n            this.incarnate(data);\r\n        else\r\n            data.element.dataset[hyphenSeparatedToCamelize(data.dataname)] = v == null ? '' : <string>v;\r\n    }\r\n\r\n\r\n}\r\n\r\nexport function camelToHyphenSeparated(str: string) {\r\n    return str.replace(/[A-Z]/g, (s: string) => '-' + s.toLowerCase());\r\n}\r\n\r\nexport function hyphenSeparatedToCamelize(str: string) {\r\n    return str.replace(/-[a-z]/g, (s: string) => s.charAt(1).toUpperCase());\r\n}\r\n","import { jshtmlVisitor } from \"./jshtmlVisitor\";\r\nimport { jsxml } from \"./jsxml\";\r\n\r\nexport class jshtml extends jsxml {\r\n    \r\n    protected _visitor = jshtmlVisitor;\r\n\r\n    defineAs(tag: string, super_: { new(...args:unknown[]): HTMLElement } = HTMLElement) {\r\n        const mount = (e: HTMLElement) => this.mountAsContents(e.attachShadow({ mode: \"closed\" }));\r\n        const elm_class = class extends super_ {\r\n            static tag = tag\r\n            constructor(...args: unknown[]) {\r\n                super(...args);\r\n                mount(this);\r\n            }\r\n        }\r\n        customElements.define(tag, elm_class)\r\n        return elm_class;\r\n    }\r\n\r\n}\r\n\r\n","import { TimerSystem, TimerSystemImpl } from \"sodiumjs\";\r\n\r\n/**\r\n * MilisecondTimerSystemImplを参考に、requestAnimationFrame() を組み込むために作成\r\n */\r\nclass AnimationFrameTimerImpl extends TimerSystemImpl {\r\n\r\n    now = Date.now.bind(Date)\r\n\r\n    setTimer(t : number, callback : () => void) : () => void {\r\n        return this.now() < t\r\n            ? clearTimeout.bind(null, setTimeout(callback, t))\r\n            : cancelAnimationFrame.bind(null, requestAnimationFrame(callback))\r\n    }\r\n\r\n}\r\n\r\nexport class AnimationFrameTimerSystem extends TimerSystem {\r\n\r\n    constructor() {\r\n        super(new AnimationFrameTimerImpl());\r\n    }\r\n\r\n}\r\n","import { Cell, CellLoop, Operational, Stream, TimerSystem, Transaction } from \"sodiumjs\";\r\n\r\n/**\r\n * sodium公式でも使用される時間Stream。一定時間毎に時刻を送信する。\r\n */\r\nexport function periodic(sys: TimerSystem, ms: number) {\r\n    return Transaction.run(() => {\r\n        const oAlarm = new CellLoop<number>();\r\n        const sAlarm = sys.at(oAlarm);\r\n        oAlarm.loop(sAlarm.map((t:number) => t+ms).hold(sys.time.sample() + ms));\r\n        return sAlarm;\r\n    })\r\n}\r\n    \r\n/**\r\n * 現在時刻から指定ミリ秒が経過するまで、0~1の範囲をサンプリングするStream\r\n */\r\nexport function duration(sys: TimerSystem, ms:number) : Stream<number> & { end: Stream<number> } {\r\n    const start_t = sys.time.sample();\r\n    const end_t = start_t + ms;\r\n    return Transaction.run(() => {\r\n        const oAlarm = new CellLoop<number>();\r\n        const sAlarm = sys.at(oAlarm);\r\n        oAlarm.loop(sAlarm\r\n            .snapshot(sys.time, (t,now) => now < end_t ? now : t === end_t ? null : end_t)\r\n            .hold(start_t) as Cell<number>);\r\n        const sResult = sAlarm.map((t) => {\r\n            const _t = t - start_t;\r\n            return _t ? Math.min(_t / end_t-start_t, 1) : _t;\r\n        });\r\n        return Object.assign(sResult, { end: Operational.defer(sResult.filter((t) => t === 1)) })\r\n    })\r\n}\r\n\r\n\r\n\r\n","import {jsxml as _jsxml} from \"./domsubi/jsxml\";\r\nimport {jshtml as _jshtml} from \"./domsubi/jshtml\";\r\nimport {jsxmlVisitor} from \"./domsubi/jsxmlVisitor\";\r\nimport {jshtmlVisitor} from \"./domsubi/jshtmlVisitor\";\r\nimport {AnimationFrameTimerSystem} from \"./domsubi/AnimationFrameTimerSystem\"\r\nimport {periodic,duration} from \"./domsubi/nornir\"\r\nimport {AttributesSource,EventStreamMap,NodeSource} from \"./domsubi/types\";\r\nimport {StreamSink,Operational,Cell} from \"sodiumjs\";\r\n\r\n/**\r\n * ターゲットのイベントをStream化する。\r\n */\r\nexport const events = (t: EventTarget) : EventStreamMap => {\r\n    const map = {} as EventStreamMap;\r\n    const send = (e: Event) => map[e.type as keyof EventStreamMap].send(e)\r\n    return new Proxy(map, {\r\n        get: (o,p) => {\r\n            if(typeof p === 'symbol' || o.hasOwnProperty(p)) return Reflect.get(o,p);\r\n            t.addEventListener(p,send);\r\n            return (o[p] = new StreamSink<Event>());\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * ターゲットの変異をStream化する。\r\n */\r\nexport const mutations = (n: Node, init?: MutationObserverInit) => {\r\n    const sink = new StreamSink<MutationRecord[]>();\r\n    const observer = new MutationObserver(sink.send.bind(sink));\r\n    observer.observe(n, init);\r\n    return Operational.split(sink);\r\n}\r\n\r\n/**\r\n * ターゲットの属性をCell化する。\r\n */\r\nexport const attributes = (e: Element, filter?: string[]) : { [key:string]: Cell<string> } => {\r\n    const sAttrChanges = mutations(e, { attributes: true, attributeFilter: filter })\r\n    return new Proxy({}, {\r\n        get: (o,p) => {\r\n            if(typeof p === 'string' && !o.hasOwnProperty(p))\r\n                Reflect.set(o,p,\r\n                    sAttrChanges\r\n                        .filter((r) => r.attributeName === p)\r\n                        .map((r) => e.getAttribute(p) || '')\r\n                        .hold(e.hasAttribute(p) ? e.getAttribute(p) || '' : ''))\r\n            return Reflect.get(o,p);\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * jshtml記法のノードをElementにラップする\r\n */\r\nexport const wrap = (tag:string, attrs?: AttributesSource) => attrs\r\n    ? (content:NodeSource) => ({ [tag]: content, $: attrs })\r\n    : (content:NodeSource) => ({ [tag]: content });\r\n   \r\n\r\n// jsxml, jshtmlは純粋関数としても活用できるようにProxyをかます\r\nconst proxy_handler = {\r\n    apply(target: { new(s:NodeSource): _jsxml } | { new(s:NodeSource): _jshtml }, b:unknown, c:NodeSource[]) { return new target(c[0]) }\r\n};\r\n\r\nexport const jsxml  = new Proxy(_jsxml, proxy_handler as ProxyHandler<{ new(): _jsxml }>) as typeof _jsxml & ((s:NodeSource) => _jsxml);\r\nexport const jshtml = new Proxy(_jshtml, proxy_handler as ProxyHandler<{ new(): _jshtml }>) as typeof _jshtml & ((s:NodeSource) => _jshtml);\r\n\r\nexport {jsxmlVisitor,jshtmlVisitor,AnimationFrameTimerSystem,periodic,duration};\r\n"],"names":["jsxml","jshtml","_jsxml","_jshtml"],"mappings":"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"}